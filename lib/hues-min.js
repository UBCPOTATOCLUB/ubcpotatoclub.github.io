"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();!function(t,i){var e=function(){function e(s,a,h){_classCallCheck(this,e),this.audio=a,a.addEventListener("seek",this.resetEffects.bind(this)),h.addEventListener("newsong",this.resetEffects.bind(this)),h.addEventListener("newimage",this.setImage.bind(this)),h.addEventListener("newcolour",this.setColour.bind(this)),h.addEventListener("beat",this.beat.bind(this)),h.addEventListener("invert",this.setInvert.bind(this)),h.addEventListener("settingsupdated",this.settingsUpdated.bind(this)),h.addEventListener("frame",this.animationLoop.bind(this)),this.core=h,this.needsRedraw=!1,this.colour=16777215,this.image=null,this.smartAlign=!0,this.animTimeout=null,this.animFrame=null,this.lastBeat=0,this.blurDecay=null,this.blurAmount=null,this.blurIterations=null,this.blurDelta=null,this.blurAlpha=null,this.blurStart=0,this.blurDistance=0,this.xBlur=!1,this.yBlur=!1,this.sliceDistance=0,this.sliceStart=0,this.slices={x:this.makeSliceObj(25),y:this.makeSliceObj(15)},this.trippyStart=[0,0],this.trippyRadii=[0,0],this.trippyOn=!1,this.trippyRadius=0,this.blackout=!1,this.blackoutColour="#000",this.blackoutTimeout=null,this.lastBlackout=0,this.currentBlackout=-1,this.lastFrameBlack=!1,this.invert=!1,this.colourFade=!1,this.colourFadeStart=0,this.colourFadeLength=0,this.oldColour=16777215,this.newColour=16777215,this.blendMode="hard-light",this.setBlurAmount("medium"),this.setBlurQuality("high"),this.setBlurDecay("fast"),this.canvas=i.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1280,this.canvas.height=720,this.canvas.className="hues-canvas",s.appendChild(this.canvas),this.offCanvas=i.createElement("canvas"),this.offContext=this.offCanvas.getContext("2d"),t.addEventListener("resize",this.resize.bind(this)),this.resize()}return _createClass(e,[{key:"makeSliceObj",value:function(t){return{count:0,avgSegments:t,segments:[],distances:[]}}},{key:"setInvert",value:function(t){this.invert=t,this.needsRedraw=!0}},{key:"settingsUpdated",value:function(){this.setSmartAlign(this.core.settings.smartAlign),this.setBlurAmount(this.core.settings.blurAmount),this.setBlurDecay(this.core.settings.blurDecay),this.setBlurQuality(this.core.settings.blurQuality),this.trippyOn="on"==this.core.settings.trippyMode}},{key:"resetEffects",value:function(){this.colourFadeStart=0,this.colourFade=!1,this.trippyStart=[0,0],this.sliceStart=0,this.blurStart=0,this.blurDistance=0,this.xBlur=!1,this.yBlur=!1}},{key:"resize",value:function(){var t=this.core.root.clientHeight,i=this.core.root.clientWidth/t;this.canvas.height=Math.min(t,720),this.canvas.width=Math.ceil(this.canvas.height*i),this.offCanvas.height=this.canvas.height,this.offCanvas.width=this.canvas.width,this.trippyRadius=Math.max(this.canvas.width,this.canvas.height)/2,this.needsRedraw=!0}},{key:"redraw",value:function(){var t=void 0,i=void 0,e=this.canvas.width,s=this.canvas.height,a=this.audio.currentTime;if(this.context.globalAlpha=1,this.context.globalCompositeOperation="source-over",this.blackout){if(i=10*(a-this.blackoutStart),i>1){if(this.lastBlackout==this.currentBlackout||!this.lastFrameBlack)return this.lastFrameBlack=!0,this.lastBlackout=this.currentBlackout,this.context.fillStyle=this.blackoutColour,this.context.fillRect(0,0,e,s),this.needsRedraw=!1,void this.drawInvert();this.lastFrameBlack=!1,this.context.fillStyle="#FFF",this.context.fillRect(0,0,e,s)}}else this.lastFrameBlack=!1,this.context.fillStyle="#FFF",this.context.fillRect(0,0,e,s);if(this.image&&(this.image.bitmap||this.image.bitmaps)){var h=this.image.animated?this.image.bitmaps[this.animFrame]:this.image.bitmap,r=h.height*(s/h.height),n=h.width/h.height*r;if(this.smartAlign)switch(this.image.align){case"left":t=0;break;case"right":t=e-n;break;default:t=e/2-n/2}else t=e/2-n/2;this.sliceStart&&(h=this.drawSlice(h,n,r,e,s),n=e,r=s),this.xBlur||this.yBlur?this.drawBlur(h,t,n,r):(this.context.globalAlpha=1,this.context.drawImage(h,t,0,n,r))}this.trippyStart[0]||this.trippyStart[1]?this.drawTrippy(e,s):(this.offContext.fillStyle=this.intToHex(this.colour),this.offContext.fillRect(0,0,e,s)),this.context.globalAlpha=.7,this.context.globalCompositeOperation=this.blendMode,this.context.drawImage(this.offCanvas,0,0),this.blackout?(this.context.globalAlpha=i,this.context.fillStyle=this.blackoutColour,this.context.fillRect(0,0,e,s),this.needsRedraw=!0):this.needsRedraw=!1,this.drawInvert()}},{key:"drawInvert",value:function(){this.invert&&(this.context.globalAlpha=1,this.context.globalCompositeOperation="difference",this.context.fillStyle="#FFF",this.context.fillRect(0,0,this.canvas.width,this.canvas.height))}},{key:"drawSlice",value:function(t,i,e,s,a){this.offContext.clearRect(0,0,s,a);for(var h=0,r=0,n=0;n<this.slices.x.count;n++){for(var l=this.slices.x.segments[n],o=this.slices.x.distances[n]*this.sliceDistance,u=Math.ceil(l*t.width),c=Math.ceil(l*i),d=0,m=0,f=0;f<this.slices.y.count;f++){var p=this.slices.y.segments[f],b=this.slices.y.distances[f]*this.sliceDistance,v=Math.ceil(p*t.height),g=Math.ceil(p*e);this.offContext.drawImage(t,h,d,u,v,r+b,m+o,c,g),d+=v,m+=g}h+=u,r+=c}return this.offCanvas}},{key:"drawBlur",value:function(t,i,e,s){if(this.context.globalAlpha=this.blurAlpha,this.xBlur)if(this.blurIterations<0)this.context.globalAlpha=1,this.context.drawImage(t,Math.floor(i-this.blurDistance/2),0,e+this.blurDistance,s);else for(var a=-1;a<=1;a+=this.blurDelta)this.context.drawImage(t,Math.floor(this.blurDistance*a)+i,0,e,s);else if(this.yBlur)if(this.blurIterations<0)this.context.globalAlpha=1,this.context.drawImage(t,i,Math.floor(-this.blurDistance/2),e,s+this.blurDistance);else for(var h=-1;h<=1;h+=this.blurDelta)this.context.drawImage(t,i,Math.floor(this.blurDistance*h),e,s)}},{key:"drawTrippy",value:function(t,i){var e=this.trippyStart[1]>this.trippyStart[0],s=this.intToHex(16777215^this.colour),a=this.intToHex(this.colour);this.offContext.fillStyle=e?s:a,this.offContext.fillRect(0,0,t,i),this.trippyRadii.sort(function(t,i){return i-t});for(var h=!e,r=0;r<2;r++)0!==this.trippyRadii[r]&&(this.offContext.beginPath(),this.offContext.fillStyle=this.intToHex(h?s:a),this.offContext.arc(t/2,i/2,this.trippyRadii[r],0,2*Math.PI,!1),this.offContext.fill(),this.offContext.closePath(),h=!h)}},{key:"intToHex",value:function(t){return"#"+("00000"+t.toString(16)).slice(-6)}},{key:"animationLoop",value:function(){if(this.colourFade){var t=this.audio.currentTime-this.colourFadeStart,i=t/this.colourFadeLength;i>=1?(this.stopFade(),this.colour=this.newColour):this.mixColours(i),this.needsRedraw=!0}if(this.blackoutTimeout&&this.audio.currentTime>this.blackoutTimeout&&this.clearBlackout(),this.image&&this.image.animated)if(this.image.beatsPerAnim&&this.core.currentSong&&this.core.currentSong.charsPerBeat){var e=this.animFrame;this.syncAnim(),this.animFrame!=e&&(this.needsRedraw=!0,this.animTimeout=this.audio.currentTime)}else this.animTimeout<this.audio.currentTime&&(this.animFrame++,this.animFrame%=this.image.frameDurations.length,this.animTimeout+=this.image.frameDurations[this.animFrame]/1e3,this.needsRedraw=!0);if(this.blurStart){var s=this.audio.currentTime-this.blurStart+1/30;this.blurDistance=this.blurAmount*Math.exp(-this.blurDecay*s);var a=this.blurDistance/this.blurAmount;this.xBlur?this.core.blurUpdated(a,0):this.core.blurUpdated(0,a)}if(this.sliceStart){var h=.8,r=void 0,n=this.audio.currentTime;if(n<this.sliceRampUp)r=this.sliceRampUp-n,this.sliceDistance=(1-r/this.sliceTransitionTime)*h;else if(n<this.sliceRampDown){r=this.sliceRampDown-n;var l=this.sliceRampDown-this.sliceRampUp;this.sliceDistance=h+(1-r/l)*(1-h)}else{var o=this.sliceRampDown+this.sliceTransitionTime;n>o?(this.sliceStart=0,this.sliceDistance=0):(r=o-n,this.sliceDistance=r/this.sliceTransitionTime)}this.needsRedraw=!0}for(var u=0;u<2;u++)if(this.trippyStart[u]||this.trippyRadii[u]){if(this.needsRedraw=!0,this.trippyRadii[u]=2*Math.floor((this.audio.currentTime-this.trippyStart[u])*this.trippyRadius),this.trippyRadii[u]>this.trippyRadius){this.trippyStart[u]=0,this.trippyRadii[u]=0;continue}u%2===0&&(this.trippyRadii[u]=this.trippyRadius-this.trippyRadii[u])}this.blurStart&&this.blurDistance<1?(this.core.blurUpdated(0,0),this.blurDistance=0,this.blurStart=0,this.xBlur=this.yBlur=!1,this.redraw()):this.blurStart?this.redraw():this.needsRedraw&&this.redraw()}},{key:"setImage",value:function(t){this.image!=t&&(this.needsRedraw=!0,this.image=t,t&&(t.bitmap||t.bitmaps)&&t.animated&&(this.animBeat=null,this.animFrame=0,this.animTimeout=this.audio.currentTime+t.frameDurations[0]/1e3,t.beatsPerAnim&&this.core.currentSong&&this.core.currentSong.charsPerBeat&&this.syncAnim()))}},{key:"beat",value:function(){this.lastBeat=this.audio.currentTime}},{key:"syncAnim",value:function(){var t=this.core.currentSong;if(t){var i=this.core.beatIndex;if(this.lastBeat&&this.core.getBeatLength()){var e=(this.audio.currentTime-this.lastBeat)/this.core.getBeatLength();i+=Math.min(e,1)}var s=i/t.charsPerBeat%this.image.beatsPerAnim,a=this.image.bitmaps.length;this.animFrame=Math.floor(a*(s/this.image.beatsPerAnim)),this.image.syncOffset&&(this.animFrame+=this.image.syncOffset),this.animFrame=(this.animFrame%a+a)%a}}},{key:"setColour",value:function(t,i){t.c!=this.colour&&(i?this.newColour=t.c:(this.stopFade(),this.colour=t.c),this.needsRedraw=!0)}},{key:"doBlackout",value:function(t){"undefined"==typeof t&&(t=!1),t?this.blackoutColour="#FFF":this.blackoutColour="#000",this.blackoutTimeout=0,this.blackout||(this.blackoutStart=this.audio.currentTime),this.blackout=!0,this.needsRedraw=!0,"on"==this.core.settings.blackoutUI&&this.core.userInterface.hide()}},{key:"clearBlackout",value:function(){this.blackout=!1,this.blackoutTimeout=0,this.needsRedraw=!0,"on"==this.core.settings.blackoutUI&&this.core.userInterface.show()}},{key:"doShortBlackout",value:function(t){this.doInstantBlackout(),this.blackoutTimeout=this.audio.currentTime+t/1.7,this.currentBlackout++}},{key:"doInstantBlackout",value:function(){this.doBlackout(),this.blackoutStart=-Math.pow(2,32)}},{key:"doColourFade",value:function(t){this.colourFade=!0,this.colourFadeLength=t,this.colourFadeStart=this.audio.currentTime,this.oldColour=this.colour}},{key:"stopFade",value:function(){this.colourFade=!1,this.colourFadeStart=0,this.colourFadeLength=0}},{key:"mixColours",value:function(t){t=Math.min(1,t);var i=this.oldColour>>16&255,e=this.oldColour>>8&255,s=255&this.oldColour,a=this.newColour>>16&255,h=this.newColour>>8&255,r=255&this.newColour,n=i*(1-t)+a*t,l=e*(1-t)+h*t,o=s*(1-t)+r*t;this.colour=n<<16|l<<8|o}},{key:"doXBlur",value:function(){this.blurStart=this.audio.currentTime,this.trippyOn&&(this.trippyStart[0]=this.blurStart),this.blurDistance=this.blurAmount,this.xBlur=!0,this.yBlur=!1,this.needsRedraw=!0}},{key:"doYBlur",value:function(){this.blurStart=this.audio.currentTime,this.trippyOn&&(this.trippyStart[1]=this.blurStart),this.blurDistance=this.blurAmount,this.xBlur=!1,this.yBlur=!0,this.needsRedraw=!0}},{key:"doTrippyX",value:function(){var t=this.trippyOn;this.trippyOn=!0,this.doXBlur(),this.trippyOn=t}},{key:"doTrippyY",value:function(){var t=this.trippyOn;this.trippyOn=!0,this.doYBlur(),this.trippyOn=t}},{key:"doSlice",value:function(t,i,e,s){var a=Math.min(.06,t);this.sliceStart=this.audio.currentTime,this.sliceRampUp=this.sliceStart+a,this.sliceRampDown=this.sliceStart+t*i-a,this.sliceTransitionTime=a,e?this.generateSliceSegments("x"):this.resetSliceSegments("x"),s?this.generateSliceSegments("y"):this.resetSliceSegments("y"),this.needsRedraw=!0}},{key:"generateSliceSegments",value:function(t){var i=1/this.slices[t].avgSegments,e=i/2,s=0,a=void 0;for(a=0;;a++){var h=i+Math.random()*e*2-e;if(this.slices[t].segments[a]=h,s+=h,this.slices[t].distances[a]=Math.random()*this.blurAmount-this.blurAmount/2,s>1){this.slices[t].segments[a]-=s-1;break}}this.slices[t].count=a+1}},{key:"resetSliceSegments",value:function(t){this.slices[t].count=1,this.slices[t].segments[0]=1,this.slices[t].distances[0]=0}},{key:"setBlurDecay",value:function(t){this.blurDecay={slow:7.8,medium:14.1,fast:20.8,"faster!":28.7}[t]}},{key:"setBlurQuality",value:function(t){this.blurIterations={low:-1,medium:11,high:19,extreme:35}[t],this.blurDelta=1/(this.blurIterations/2),this.blurAlpha=1/(this.blurIterations/2)}},{key:"setBlurAmount",value:function(t){this.blurAmount={low:48,medium:96,high:384}[t]}},{key:"setSmartAlign",value:function(t){this.smartAlign="on"==t}}]),e}();t.HuesCanvas=e}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();!function(e,t){var n=function(){function n(s){var i=this;_classCallCheck(this,n),this.eventListeners={loaded:[],time:[],blurupdate:[],newsong:[],newimage:[],newcolour:[],newmode:[],beat:[],invert:[],frame:[],songstarted:[],settingsupdated:[]},this.version=34,this.versionStr=(this.version/10).toFixed(1),this.versionHex=this.version.toString(16),this.beatIndex=0,this.buildLength=-1,this.loopLength=-1,this.currentSong=null,this.currentImage=null,this.songIndex=-1,this.imageIndex=-1,this.lastSongArray=[],this.lastImageArray=[],this.colourIndex=63,this.colours=n.oldColours,this.invert=!1,this.loopCount=0,this.doBuildup=!0,this.userInterface=null,this.uiArray=[],this.settings=new HuesSettings(s),zip.workerScriptsPath=this.settings.workersPath,this.root=null,this.settings.root?"string"==typeof this.settings.root?this.settings.root&&t.getElementById(this.settings.root)?this.root=t.getElementById(this.settings.root):this.root=t.body:this.root=this.settings.root:this.root=t.body,this.root.classList.add("hues-root"),this.root===t.body&&(t.documentElement.className="hues-root"),this.root.innerHTML="",this.makePreloader(this.root),e.onerror=function(e,t,n,s,r){return i.error(e),!1},this.window=new HuesWindow(this.root,this.settings),console.log("0x40 Hues v"+this.versionStr+" - start your engines!"),this.resourceManager=new Resources(this,this.window),this.editor=new HuesEditor(this,this.window),this.settings.initUI(this.window),populateHuesInfo(this.versionStr,this.window,this.settings),this.window.selectTab(this.settings.firstWindow,!0);var r=t.createElement("div");r.className="hues-ui",this.root.appendChild(r),this.uiArray.push(new RetroUI(r),new WeedUI(r),new ModernUI(r),new XmasUI(r),new HalloweenUI(r),new MinimalUI(r)),this.autoSong=this.settings.autoSong,this.visualiser=t.createElement("canvas"),this.visualiser.className="hues-visualiser",this.visualiser.height="64",this.vCtx=this.visualiser.getContext("2d"),this.soundManager=new SoundManager(this),this.soundManager.init().then(function(){return i.soundManager.locked||"on"!=i.settings.skipPreloader?i.resourceManager.getSizes(i.settings.respacks):null}).then(function(e){if(null!==e){var t=e.reduce(function(e,t){return"number"==typeof t?e+t:null},0);t="number"==typeof t?t.toFixed(1):'<abbr title="Content-Length header not present for respack URLs">???</abbr>';var n=t+"MB of music/images.<br />Flashing lights.<br /><b>Tap or click to start</b>";return i.soundManager.locked||(n+="<br /><span>Skip this screen from Options</span>"),i.warning(n),i.soundManager.unlock()}}).then(function(){return i.clearMessage(),setInterval(i.loopCheck.bind(i),1e3),i.renderer=new HuesCanvas(i.root,i.soundManager,i),i.settings.addEventListener("updated",i.settingsUpdated.bind(i)),i.settingsUpdated(),i.setColour(i.colourIndex),i.animationLoop(),i.settings.load?i.resourceManager.addAll(i.settings.respacks,function(e){i.preloader.style.backgroundPosition=100-100*e+"% 0%";var t=Math.floor(e*i.settings.preloadMax),n=i.settings.preloadMax.toString(i.settings.preloadBase).length;i.preloadMsg.textContent=i.settings.preloadPrefix+(Array(n).join("0")+t.toString(i.settings.preloadBase)).slice(-n)}):void(i.preloader.style.display="none")}).then(function(){i.preloader.classList.add("hues-preloader--loaded"),i.callEventListeners("loaded"),i.settings.firstImage?i.setImageByName(i.settings.firstImage):i.setImage(0),i.settings.autoplay&&(i.settings.firstSong?i.setSongByName(i.settings.firstSong):i.setSong(0))})["catch"](function(e){i.error(e)}),this.settings.disableKeyboard||t.addEventListener("keydown",function(t){if(t=t||e.event,t.defaultPrevented)return!0;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return!0;if("input"==t.target.tagName.toLowerCase()&&"text"==t.target.type||"true"===t.target.contentEditable)return!0;var n=t.keyCode||t.which;return i.keyHandler(n)})}return _createClass(n,[{key:"callEventListeners",value:function(e){var t=Array.prototype.slice.call(arguments,1);this.eventListeners[e].forEach(function(e){e.apply(null,t)})}},{key:"addEventListener",value:function(e,t){if(e=e.toLowerCase(),"undefined"==typeof this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e=e.toLowerCase(),"undefined"==typeof this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e]=this.eventListeners[e].filter(function(e){return e!==t})}},{key:"makePreloader",value:function(e){this.preloader=t.createElement("div"),this.preloader.className="hues-preloader",e.appendChild(this.preloader),this.settings.preloadTitle&&(this.preloadTitle=t.createElement("div"),this.preloadTitle.className="hues-preloader__title",this.preloadTitle.textContent=this.settings.preloadTitle,this.preloader.appendChild(this.preloadTitle)),this.preloadMsg=t.createElement("div"),this.preloadMsg.className="hues-preloader__text",this.preloadMsg.textContent="Initialising...",this.preloader.appendChild(this.preloadMsg),this.preloadSubMsg=t.createElement("div"),this.preloadSubMsg.className="hues-preloader__subtext",this.preloader.appendChild(this.preloadSubMsg)}},{key:"resizeVisualiser",value:function(){this.soundManager.initVisualiser(this.visualiser.width/2)}},{key:"updateVisualiser",value:function(){if("on"==this.settings.visualiser){var e=this.soundManager.getVisualiserData();if(e){this.vCtx.clearRect(0,0,this.vCtx.canvas.width,this.vCtx.canvas.height);var t=this.vCtx.createLinearGradient(0,64,0,0);this.invert?(t.addColorStop(1,"rgba(20,20,20,0.6)"),t.addColorStop(0,"rgba(255,255,255,0.6)")):(t.addColorStop(1,"rgba(255,255,255,0.6)"),t.addColorStop(0,"rgba(20,20,20,0.6)")),this.vCtx.fillStyle=t;for(var n=2,s=void 0,i=0,r=0;r<e.length;r++)for(var a=e[r],o=0;o<a.length;o++){var l=0;l=2==e.length&&0===r?a.length-o-1:o,s=a[l]/4,this.vCtx.fillRect(i,this.vCtx.canvas.height-s,n,s),i+=n}}}}},{key:"animationLoop",value:function(){if(requestAnimationFrame(this.animationLoop.bind(this)),!this.soundManager.playing)return void this.callEventListeners("frame");this.updateVisualiser();var e=this.soundManager.currentTime;this.callEventListeners("time",this.soundManager.clampedTime),e>=0&&this.doBuildup&&(this.currentSong.buildupPlayed=!0);for(var t=this.beatIndex*this.getBeatLength();t<e;t=++this.beatIndex*this.getBeatLength()){var n=this.getBeat(this.beatIndex);this.beater(n)}this.callEventListeners("frame")}},{key:"recalcBeatIndex",value:function(e){var t="number"==typeof e?e:this.soundManager.currentTime;if(this.beatIndex=Math.floor(t/(t<0?this.buildLength:this.loopLength)),this.beatIndex!=this.beatIndex)return void this.setInvert(!1);var n=this.currentSong.buildupRhythm,s=this.currentSong.rhythm,i=void 0;if(this.beatIndex<0)i=n.slice(0,Math.max(this.beatIndex+n.length,0));else{if((s.match(/i|I/g)||[]).length%2)return;i=(n?n:"")+s.slice(0,this.beatIndex)}var r=(i.match(/i|I/g)||[]).length;this.setInvert(r%2)}},{key:"getBeatIndex",value:function(){return this.soundManager.playing?this.beatIndex<0?this.beatIndex:this.beatIndex%this.currentSong.rhythm.length:0}},{key:"getSafeBeatIndex",value:function(){var e=this.getBeatIndex();return e<0?0:e}},{key:"blurUpdated",value:function(e,t){this.callEventListeners("blurupdate",e,t)}},{key:"nextSong",value:function(){var e=(this.songIndex+1)%this.resourceManager.enabledSongs.length;this.setSong(e)}},{key:"previousSong",value:function(){var e=(this.songIndex-1+this.resourceManager.enabledSongs.length)%this.resourceManager.enabledSongs.length;this.setSong(e)}},{key:"setSongByName",value:function(e){for(var t=this.resourceManager.enabledSongs,n=0,s=0,i=0;i<t.length;i++){var r=t[i].title.score(e);r>s&&(s=r,n=i)}return this.setSong(n)}},{key:"setSongOject",value:function(e){for(var t=0;t<this.resourceManager.enabledSongs.length;t++)if(this.resourceManager.enabledSongs[t]===e)return this.setSong(t)}},{key:"setSong",value:function(e,t){var n=this;if(this.currentSong!=this.resourceManager.enabledSongs[e]){if(t||(this.lastSongArray=[]),this.lastSongArray.push(e),this.songIndex=e,this.currentSong=this.resourceManager.enabledSongs[this.songIndex],void 0===this.currentSong&&(this.currentSong={name:"None",title:"None",rhythm:".",source:null,crc:"none",sound:null,enabled:!0,filename:"none"}),console.log("Next song:",this.songIndex,this.currentSong),this.callEventListeners("newsong",this.currentSong),this.loopCount=0,this.currentSong.buildup)switch(this.settings.playBuildups){case"off":this.currentSong.buildupPlayed=!0,this.doBuildup=!1;break;case"on":this.currentSong.buildupPlayed=!1,this.doBuildup=!0;break;case"once":this.doBuildup=!this.currentSong.buildupPlayed}return this.setInvert(!1),this.renderer.doInstantBlackout(),this.soundManager.playSong(this.currentSong,this.doBuildup).then(function(){n.resetAudio(),n.fillBuildup(),n.callEventListeners("songstarted",n.currentSong)})}}},{key:"updateBeatLength",value:function(){this.loopLength=this.soundManager.loopLength/this.currentSong.rhythm.length,this.currentSong.buildup?(this.currentSong.buildupRhythm||(this.currentSong.buildupRhythm="."),this.buildLength=this.soundManager.buildLength/this.currentSong.buildupRhythm.length):this.buildLength=-1}},{key:"getBeatLength",value:function(){return this.beatIndex<0?this.buildLength:this.loopLength}},{key:"fillBuildup",value:function(){if(this.updateBeatLength(),this.currentSong.buildup)if(this.currentSong.independentBuild)console.log("New behaviour - separate build/loop lengths");else{console.log("Flash behaviour - filling buildup");var e=Math.floor(this.soundManager.buildLength/this.loopLength);for(e<1&&(e=1);this.currentSong.buildupRhythm.length<e;)this.currentSong.buildupRhythm=this.currentSong.buildupRhythm+".";console.log("Buildup length:",e)}this.updateBeatLength(),this.recalcBeatIndex(this.doBuildup?-this.soundManager.buildLength:0)}},{key:"randomSong",value:function(){var e=this.resourceManager.enabledSongs.length,t=Math.floor(Math.random()*e);if(e>1&&(t==this.songIndex||this.lastSongArray.indexOf(t)!=-1))this.randomSong();else{console.log("Randoming a song!"),this.setSong(t,!0);for(var n=Math.min(5,Math.floor(e/2));this.lastSongArray.length>n&&n>=0;)this.lastSongArray.shift()}}},{key:"loopCheck",value:function(){Math.floor(this.soundManager.currentTime/this.soundManager.loopLength)>this.loopCount&&this.onLoop()}},{key:"onLoop",value:function(){switch(this.loopCount++,this.settings.autoSong){case"loop":console.log("Checking loops"),this.loopCount>=this.settings.autoSongDelay&&this.doAutoSong();break;case"time":console.log("Checking times"),this.soundManager.loopLength*this.loopCount>=60*this.settings.autoSongDelay&&this.doAutoSong()}}},{key:"doAutoSong",value:function(){var e=this,t=null;this.resourceManager.enabledSongs.length<2||(t="on"==this.settings.autoSongShuffle?this.randomSong:this.nextSong,"on"==this.settings.autoSongFadeout?this.soundManager.fadeOut(function(){t.call(e)}):t.call(this))}},{key:"songDataUpdated",value:function(){this.currentSong&&(this.callEventListeners("newsong",this.currentSong),this.callEventListeners("newimage",this.currentImage))}},{key:"resetAudio",value:function(){this.beatIndex=0,this.songDataUpdated(),"on"==this.settings.visualiser&&this.soundManager.initVisualiser(this.visualiser.width/2)}},{key:"randomImage",value:function(){if("on"==this.settings.shuffleImages){var e=this.resourceManager.enabledImages.length,t=Math.floor(Math.random()*e);if((t==this.imageIndex||this.lastImageArray.indexOf(t)!=-1)&&e>1)this.randomImage();else{this.setImage(t,!0),this.lastImageArray.push(t);for(var n=Math.min(20,Math.floor(e/2));this.lastImageArray.length>n&&n>=0;)this.lastImageArray.shift()}}else{var s=(this.imageIndex+1)%this.resourceManager.enabledImages.length;this.setImage(s)}}},{key:"setImage",value:function(e,t){this.imageIndex=e?e:0;var n=this.resourceManager.enabledImages[this.imageIndex];n==this.currentImage&&null!==n||(t||(this.lastImageArray=[]),n?this.currentImage=n:(this.currentImage={name:"None",fullname:"None",align:"center",bitmap:null,source:null,enabled:!0},this.imageIndex=-1,this.lastImageArray=[]),this.callEventListeners("newimage",this.currentImage))}},{key:"setImageByName",value:function(e){for(var t=this.resourceManager.enabledImages,n=0;n<t.length;n++)if(t[n].name==e||t[n].fullname==e)return void this.setImage(n);this.setImage(0)}},{key:"nextImage",value:function(){this.setIsFullAuto(!1);var e=(this.imageIndex+1)%this.resourceManager.enabledImages.length;this.setImage(e)}},{key:"previousImage",value:function(){this.setIsFullAuto(!1);var e=(this.imageIndex-1+this.resourceManager.enabledImages.length)%this.resourceManager.enabledImages.length;this.setImage(e)}},{key:"randomColourIndex",value:function(){var e=Math.floor(Math.random()*this.colours.length);return e==this.colourIndex?this.randomColourIndex():e}},{key:"randomColour",value:function(e){var t=this.randomColourIndex();this.setColour(t,e)}},{key:"setColour",value:function(e,t){this.colourIndex=e;var n=this.colours[this.colourIndex];this.callEventListeners("newcolour",n,t)}},{key:"getBeat",value:function(e){return e<0?this.currentSong.buildupRhythm[this.currentSong.buildupRhythm.length+e]:this.currentSong.rhythm[e%this.currentSong.rhythm.length]}},{key:"beater",value:function(e){switch(this.callEventListeners("beat",this.getBeatString(),this.getBeatIndex()),e){case"X":case"x":this.renderer.doYBlur();break;case"O":case"o":this.renderer.doXBlur();break;case")":this.renderer.doTrippyX();break;case"(":this.renderer.doTrippyY();break;case"+":this.renderer.doXBlur(),this.renderer.doBlackout();break;case"¤":this.renderer.doXBlur(),this.renderer.doBlackout(!0);break;case"|":this.renderer.doShortBlackout(this.getBeatLength()),this.randomColour();break;case":":this.randomColour();break;case"*":this.settings.fullAuto&&this.randomImage();break;case"=":this.settings.fullAuto&&this.randomImage();case"~":this.renderer.doColourFade(this.timeToNextBeat()),this.randomColour(!0);break;case"S":case"s":this.renderer.doSlice(this.getBeatLength(),this.charsToNextBeat(),!1,!0);break;case"V":case"v":this.renderer.doSlice(this.getBeatLength(),this.charsToNextBeat(),!0,!1);break;case"@":case"#":this.renderer.doSlice(this.getBeatLength(),this.charsToNextBeat(),!0,!0);break;case"I":this.settings.fullAuto&&this.randomImage();case"i":this.toggleInvert()}[".","+","|","¤"].indexOf(e)==-1&&this.renderer.clearBlackout(),[".","+","¤",":","*","X","O","~","=","i","I","s","v","#"].indexOf(e)==-1&&(this.randomColour(),this.settings.fullAuto&&this.randomImage())}},{key:"charsToNextBeat",value:function(){var e=this.currentSong.rhythm.length;this.beatIndex<0&&(e-=this.beatIndex);var t=void 0;for(t=1;t<=e&&"."==this.getBeat(t+this.beatIndex);t++);return t}},{key:"timeToNextBeat",value:function(){return this.charsToNextBeat()*this.getBeatLength()/this.soundManager.playbackRate}},{key:"getBeatString",value:function(e){e=e?e:256;var t="",n=this.currentSong;if(n)for(t=this.beatIndex<0?n.buildupRhythm.slice(n.buildupRhythm.length+this.beatIndex):n.rhythm.slice(this.beatIndex%n.rhythm.length);t.length<e;)t+=n.rhythm;return t}},{key:"setIsFullAuto",value:function(e){this.settings.fullAuto=e,this.userInterface&&this.callEventListeners("newmode",this.settings.fullAuto)}},{key:"toggleFullAuto",value:function(){this.setIsFullAuto(!this.settings.fullAuto)}},{key:"setInvert",value:function(e){this.invert=!!e,this.callEventListeners("invert",e)}},{key:"toggleInvert",value:function(){this.setInvert(!this.invert)}},{key:"respackLoaded",value:function(){this.init()}},{key:"changeUI",value:function(e){e>=0&&this.uiArray.length>e&&this.userInterface!=this.uiArray[e]&&(this.hideLists(),this.userInterface&&this.userInterface.disconnect(),this.userInterface=this.uiArray[e],this.userInterface.connectCore(this),this.callEventListeners("newmode",this.settings.fullAuto),this.callEventListeners("newsong",this.currentSong),this.callEventListeners("newimage",this.currentImage),this.callEventListeners("newcolour",this.colours[this.colourIndex],!1),this.callEventListeners("beat",this.getBeatString(),this.getBeatIndex()),this.callEventListeners("invert",this.invert))}},{key:"settingsUpdated",value:function(){switch(this.callEventListeners("settingsupdated"),this.settings.currentUI){case"retro":this.changeUI(0);break;case"v4.20":this.changeUI(1);break;case"modern":this.changeUI(2);break;case"xmas":this.changeUI(3);break;case"hlwn":this.changeUI(4);break;case"mini":this.changeUI(5)}switch(this.settings.colourSet){case"normal":this.colours=n.oldColours;break;case"pastel":this.colours=n.pastelColours;break;case"v4.20":this.colours=n.weedColours}switch(this.settings.blackoutUI){case"off":this.userInterface.show();break;case"on":this.renderer.blackout&&this.userInterface.hide()}switch(this.settings.visualiser){case"off":this.visualiser.classList.add("hidden");break;case"on":this.visualiser.classList.remove("hidden"),this.soundManager.vReady||this.soundManager.initVisualiser(this.visualiser.width/2)}"off"==this.autoSong&&"off"!=this.settings.autoSong&&(console.log("Resetting loopCount since AutoSong was enabled"),this.loopCount=0),this.autoSong=this.settings.autoSong}},{key:"enabledChanged",value:function(){this.resourceManager.rebuildEnabled()}},{key:"hideLists",value:function(){this.resourceManager.hideLists()}},{key:"toggleSongList",value:function(){this.window.hide(),this.resourceManager.toggleSongList()}},{key:"toggleImageList",value:function(){this.window.hide(),this.resourceManager.toggleImageList()}},{key:"openSongSource",value:function(){this.currentSong&&this.currentSong.source&&e.open(this.currentSong.source,"_blank")}},{key:"openImageSource",value:function(){this.currentImage&&this.currentImage.source&&e.open(this.currentImage.source,"_blank")}},{key:"keyHandler",value:function(e){switch(e){case 37:this.previousImage();break;case 39:this.nextImage();break;case 38:this.nextSong();break;case 40:this.previousSong();break;case 70:this.toggleFullAuto();break;case 109:case 189:case 173:this.soundManager.decreaseVolume();break;case 107:case 187:case 61:this.soundManager.increaseVolume();break;case 66:this.soundManager.seek(-this.soundManager.buildLength);break;case 77:this.soundManager.toggleMute();break;case 72:this.userInterface.toggleHide();break;case 82:this.window.selectTab("RESOURCES");break;case 69:this.window.selectTab("EDITOR");break;case 79:this.window.selectTab("OPTIONS");break;case 73:this.window.selectTab("INFO");break;case 49:this.settings.set("currentUI","retro");break;case 50:this.settings.set("currentUI","v4.20");break;case 51:this.settings.set("currentUI","modern");break;case 52:this.settings.set("currentUI","xmas");break;case 53:this.settings.set("currentUI","hlwn");break;case 54:this.settings.set("currentUI","mini");break;case 67:this.toggleImageList();break;case 83:this.toggleSongList();break;case 87:this.window.toggle();break;case 78:this.randomSong();break;default:return!0}return!1}},{key:"error",value:function(e){console.log(e),this.preloadSubMsg.textContent=e,this.preloadMsg.style.color="#F00"}},{key:"warning",value:function(e){console.log(e),this.preloadSubMsg.innerHTML=e,this.preloadMsg.style.color="#F93"}},{key:"clearMessage",value:function(){this.preloadSubMsg.textContent="",this.preloadMsg.style.color=""}}]),n}();n.oldColours=[{c:0,n:"black"},{c:5570560,n:"brick"},{c:11141120,n:"crimson"},{c:16711680,n:"red"},{c:21760,n:"turtle"},{c:5592320,n:"sludge"},{c:11162880,n:"brown"},{c:16733440,n:"orange"},{c:43520,n:"green"},{c:5614080,n:"grass"},{c:11184640,n:"maize"},{c:16755200,n:"citrus"},{c:65280,n:"lime"},{c:5635840,n:"leaf"},{c:11206400,n:"chartreuse"},{c:16776960,n:"yellow"},{c:85,n:"midnight"},{c:5570645,n:"plum"},{c:11141205,n:"pomegranate"},{c:16711765,n:"rose"},{c:21845,n:"swamp"},{c:5592405,n:"dust"},{c:11162965,n:"dirt"},{c:16733525,n:"blossom"},{c:43605,n:"sea"},{c:5614165,n:"ill"},{c:11184725,n:"haze"},{c:16755285,n:"peach"},{c:65365,n:"spring"},{c:5635925,n:"mantis"},{c:11206485,n:"brilliant"},{c:16777045,n:"canary"},{c:170,n:"navy"},{c:5570730,n:"grape"},{c:11141290,n:"mauve"},{c:16711850,n:"purple"},{c:21930,n:"cornflower"},{c:5592490,n:"deep"},{c:11163050,n:"lilac"},{c:16733610,n:"lavender"},{c:43690,n:"aqua"},{c:5614250,n:"steel"},{c:11184810,n:"grey"},{c:16755370,n:"pink"},{c:65450,n:"bay"},{c:5636010,n:"marina"},{c:11206570,n:"tornado"},{c:16777130,n:"saltine"},{c:255,n:"blue"},{c:5570815,n:"twilight"},{c:11141375,n:"orchid"},{c:16711935,n:"magenta"},{c:22015,n:"azure"},{c:5592575,n:"liberty"},{c:11163135,n:"royalty"},{c:16733695,n:"thistle"},{c:43775,n:"ocean"},{c:5614335,n:"sky"},{c:11184895,n:"periwinkle"},{c:16755455,n:"carnation"},{c:65535,n:"cyan"},{c:5636095,n:"turquoise"},{c:11206655,n:"powder"},{c:16777215,n:"white"}],n.pastelColours=[{c:13453898,n:"Mahogany"},{c:16443317,n:"Banana Mania"},{c:10453360,n:"Beaver"},{c:2302755,n:"Black"},{c:12344664,n:"Chestnut"},{c:14521461,n:"Copper"},{c:10145515,n:"Cornflower"},{c:2845892,n:"Denim"},{c:15715768,n:"Desert Sand"},{c:7229792,n:"Eggplant"},{c:1964308,n:"Electric Lime"},{c:7453816,n:"Fern"},{c:16570741,n:"Goldenrod"},{c:11068576,n:"Granny Smith Apple"},{c:9802124,n:"Gray"},{c:1879160,n:"Green"},{c:16719310,n:"Hot Magenta"},{c:11725917,n:"Inch Worm"},{c:6125259,n:"Indigo"},{c:16645236,n:"Laser Lemon"},{c:16561365,n:"Lavender"},{c:16760200,n:"Macaroni and Cheese"},{c:9935530,n:"Manatee"},{c:16745027,n:"Mango Tango"},{c:16628916,n:"Melon"},{c:1722486,n:"Midnight Blue"},{c:16753475,n:"Neon Carrot"},{c:12236908,n:"Olive Green"},{c:16741688,n:"Orange"},{c:15116503,n:"Orchid"},{c:4278860,n:"Outer Space"},{c:16739914,n:"Outrageous Orange"},{c:1878473,n:"Pacific Blue"},{c:12964070,n:"Periwinkle"},{c:9323909,n:"Plum"},{c:7619272,n:"Purple Heart"},{c:14060121,n:"Raw Sienna"},{c:14886251,n:"Razzmatazz"},{c:15605837,n:"Red"},{c:2084555,n:"Robin Egg Blue"},{c:7885225,n:"Royal Purple"},{c:16751530,n:"Salmon"},{c:16525383,n:"Scarlet"},{c:10478271,n:"Sea Green"},{c:10840399,n:"Sepia"},{c:9075037,n:"Shadow"},{c:4574882,n:"Shamrock"},{c:16482045,n:"Shocking Pink"},{c:15526590,n:"Spring Green"},{c:16604755,n:"Sunset Orange"},{c:16426860,n:"Tan"},{c:16550316,n:"Tickle Me Pink"},{c:14407634,n:"Timberwolf"},{c:1540205,n:"Tropical Rain Forest"},{c:7855591,n:"Turquoise Blue"},{c:16752777,n:"Vivid Tangerine"},{c:9392285,n:"Vivid Violet"},{c:15592941,n:"White"},{c:16728996,n:"Wild Strawberry"},{c:16542853,n:"Wild Watermelon"},{c:13477086,n:"Wisteria"},{c:16574595,n:"Yellow"},{c:12968836,n:"Yellow Green"},{c:16758355,n:"Yellow Orange"}],n.weedColours=[{c:65280,n:"Green"},{c:5923665,n:"Lizard"},{c:6516567,n:"Cactus"},{c:4878371,n:"Kakapo"},{c:4018729,n:"Wet Moss"},{c:6659378,n:"Tree Moss"},{c:3297047,n:"Lime Rind"},{c:8357752,n:"Flight Jacket"},{c:12381585,n:"Green Mist"},{c:4751892,n:"Holly"},{c:5732922,n:"Mtn Dew Bottle"},{c:7635561,n:"Seaweed Roll"},{c:8647980,n:"Neon Green"},{c:12638639,n:"Lichen"},{c:10934149,n:"Guacamole"},{c:6848090,n:"Pond Scum"},{c:4153387,n:"Douglas Fir"},{c:4155430,n:"Royal Palm"},{c:6582110,n:"Seaweed"},{c:4680244,n:"Noble Fir"},{c:6159370,n:"Green Led"},{c:4414774,n:"Spinach"},{c:8699498,n:"Frog"},{c:6003812,n:"Emerald"},{c:3827241,n:"Circuit Board"},{c:3178516,n:"Sapgreen"},{c:3258701,n:"Pool Table"},{c:5615162,n:"Leaf"},{c:5094707,n:"Grass"},{c:5860438,n:"Snake"},{c:8832636,n:"100 Euro"},{c:8113264,n:"Night Vision"},{c:10494192,n:"Purple"},{c:10170623,n:"Purple"},{c:9514222,n:"Purple"},{c:8201933,n:"Purple"},{c:11141375,n:"Purple"},{c:8388736,n:"Purple"},{c:10964139,n:"Turnip"},{c:9395865,n:"Violet"},{c:8480391,n:"Eggplant"},{c:13369599,n:"Grape"},{c:8522683,n:"Wild Violet"},{c:6685080,n:"Concord Grape"},{c:7431037,n:"Garden Plum"},{c:11694758,n:"Purple Fish"},{c:6038638,n:"Ultramarine Violet"},{c:6172025,n:"Purple Rose"},{c:6830686,n:"Sea Urchin"},{c:9511326,n:"Cobalt Violet Deep"},{c:9135755,n:"Plum"},{c:10040013,n:"Dark Orchid"},{c:12541951,n:"Violet Flower"},{c:12427467,n:"Purple Candy"},{c:5577355,n:"Deep Purple"},{c:11882652,n:"Thistle"},{c:8855416,n:"Dark Purple"},{c:10251160,n:"Purple Ink"},{c:14381275,n:"Orchid"},{c:10027161,n:"True Purple"},{c:9109643,n:"Darkmagenta"},{c:11935876,n:"Harold's Crayon"},{c:6898825,n:"Purple Rain"},{c:16766720,n:"Gold"}],e.HuesCore=n}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(e,t){var i=100,n=20,s=function(){function s(e,t){_classCallCheck(this,s),this.buildEditSize=80,this.buildEdit=null,this.loopEdit=null,this.editArea=null,this.wrapAt=32,this.hilightWidth=0,this.hilightHeight=0,this.undoBuffer=[],this.redoBuffer=[],this.batchUndoArray=null,this.buildWave=null,this.loopWave=null,this.buildWaveBuff=null,this.loopWaveBuff=null,this.waveContext=null,this.waveCanvas=null,this.respack=null,this.linked=!1,this.core=e,e.settings.enableWindow&&(this.initUI(),e.addEventListener("beat",this.onBeat.bind(this)),e.addEventListener("newsong",this.onNewSong.bind(this)),t.addTab("EDITOR",this.root))}return _createClass(s,[{key:"initUI",value:function(){var i=this;this.root=t.createElement("div"),this.root.className="editor";var n=t.createElement("div");n.className="editor__title-buttons",this.root.appendChild(n),this.saveBtn=this.createButton("Save XML",n,!0),this.saveBtn.addEventListener("click",this.saveXML.bind(this)),this.copyBtn=this.createButton("Copy XML",n,!0),this.copyBtn.addEventListener("click",this.copyXML.bind(this)),this.undoBtn=this.createButton("Undo",n,!0),this.undoBtn.addEventListener("click",this.undo.bind(this)),this.redoBtn=this.createButton("Redo",n,!0),this.redoBtn.addEventListener("click",this.redo.bind(this));var s=this.createButton("Help?",n);s.style.backgroundColor="rgba(0,160,0,0.3)",s.addEventListener("click",function(){e.open("https://github.com/mon/0x40-web/tree/master/docs/Editor.md","_blank")}),this.statusMsg=t.createElement("span"),this.statusMsg.className="editor__status-msg",n.appendChild(this.statusMsg),this.topBar=t.createElement("div"),this.topBar.className="editor__top-bar",this.root.appendChild(this.topBar),this.uiCreateInfo(),this.uiCreateImport(),this.root.appendChild(t.createElement("hr")),this.uiCreateEditArea(),this.uiCreateControls(),this.uiCreateVisualiser(),t.addEventListener("keydown",function(t){if(t=t||e.event,t.defaultPrevented)return!0;var n=t.keyCode||t.which;return!t.ctrlKey||(90==n?i.undo():89==n&&i.redo(),90!=n&&89!=n)||(t.preventDefault(),!1)}),e.addEventListener("resize",this.resize.bind(this)),this.core.window.addEventListener("tabselected",this.resize.bind(this,!1)),this.resize()}},{key:"resize",value:function(i){this.root.style.height=e.innerHeight-200+"px";var n=this.editArea.offsetHeight,s=this.buildEdit._header.offsetHeight,a=this.loopEdit._header.offsetHeight,o=this.resizeHandle.offsetHeight,h=s,r=n-o-a-s,d=Math.min(r,Math.max(h,this.buildEditSize-o));this.buildEdit.style.height=d+"px",this.buildEdit._box.style.height=d-s+"px";var l=r-d+a;if(this.loopEdit.style.height=l+"px",this.loopEdit._box.style.height=l-a+"px",this.editArea.offsetHeight!=n&&this.resize(),this.timeLock.style.height=d+o+"px",!i){var u=t.createElement("div");u.className="beat-hilight";for(var c="",v=0;v<99;v++)c+="<br />";for(var p=0;p<100;p++)c+="&nbsp;";u.innerHTML=c,this.loopEdit.appendChild(u),this.hilightWidth=u.clientWidth/100,this.hilightHeight=u.clientHeight/100,this.loopEdit.removeChild(u),this.waveCanvas.width=this.waveCanvas.clientWidth}}},{key:"getOther",value:function(e){return e==this.loopEdit?this.buildEdit:this.loopEdit}},{key:"onNewSong",value:function(e){this.linked?e==this.song?(this.updateInfo(),this.updateWaveform()):(this.linked=!1,this.buildEdit._hilight.innerHTML="&block;",this.loopEdit._hilight.innerHTML="&block;",this.buildEdit._hilight.className="beat-hilight invisible",this.loopEdit._hilight.className="beat-hilight invisible",this.waveContext.clearRect(0,0,this.waveCanvas.width,n)):e==this.song&&(this.linked=!0)}},{key:"onBeat",value:function(e,t){if(this.song&&this.core.currentSong==this.song){var i=void 0;t<0?(t+=this.core.currentSong.buildupRhythm.length,i=this.buildEdit,this.loopEdit._hilight.className="beat-hilight invisible"):(i=this.loopEdit,this.song.buildup&&(this.buildEdit._hilight.className="beat-hilight invisible")),i._hilight.className="beat-hilight";var n=t%this.wrapAt,s=Math.floor(t/this.wrapAt);i._hilight.style.left=Math.floor(n*this.hilightWidth)+"px",i._hilight.style.top=Math.floor(s*this.hilightHeight)+"px"}}},{key:"reflow",value:function(e,t){if(!t)return e._beatmap.textContent="",e._hilight.textContent="[none]",e._hilight.className="beat-hilight",e._hilight.style.top="0",e._hilight.style.left="0",void(e._beatCount.textContent="0 beats");e._hilight.innerHTML="&block;",e._beatCount.textContent=t.length+" beats";var i=new RegExp("(.{"+this.wrapAt+"})","g");e._beatmap.innerHTML=t.replace(i,"$1<br />")}},{key:"updateInfo",value:function(){if(this.seekStart.classList.add("hues-button--disabled"),this.seekLoop.classList.add("hues-button--disabled"),this.saveBtn.classList.add("hues-button--disabled"),this.copyBtn.classList.add("hues-button--disabled"),this.buildEdit._removeBtn.classList.add("hues-button--disabled"),this.loopEdit._removeBtn.classList.add("hues-button--disabled"),this.song&&(this.saveBtn.classList.remove("hues-button--disabled"),this.copyBtn.classList.remove("hues-button--disabled"),this.song.independentBuild?(this.timeLock._locker.innerHTML="&#xe904;",this.timeLock.classList.add("edit-area__timelock--unlocked")):(this.timeLock._locker.innerHTML="&#xe905;",this.timeLock.classList.remove("edit-area__timelock--unlocked")),this.song.sound&&(this.seekLoop.classList.remove("hues-button--disabled"),this.loopEdit._removeBtn.classList.remove("hues-button--disabled")),this.song.buildup&&(this.seekStart.classList.remove("hues-button--disabled"),this.buildEdit._removeBtn.classList.remove("hues-button--disabled")),this.linked)){var e=this.core.soundManager.loopLength,t=this.core.soundManager.buildLength,i=e/this.song.rhythm.length*1e3;this.loopLen.textContent=e.toFixed(2),this.buildLen.textContent=t.toFixed(2),this.beatLen.textContent=i.toFixed(2)}}},{key:"loadAudio",value:function(e){var t=this;if(!(e._fileInput.files.length<1)){this.newSong(this.song);var i=!this.song[e._sound]&&!!this.song[this.getOther(e)._sound],n=e._fileInput.files[0];this.blobToArrayBuffer(n).then(function(e){var i={test:e};return t.core.soundManager.loadBuffer(i,"test").then(function(){return i.test})}).then(function(i){t.song[e._sound]=i;var s=n.name.replace(/\.[^\/.]+$/,"");if("sound"==e._sound?t.song.name=s:t.song.buildupName=s,t.getText(e)||t.setText(e,"x...o...x...o..."),t.song.sound)return t.core.soundManager.playSong(t.song,!0,!0)}).then(function(){i&&t.setIndependentBuild(!1),t.updateInfo(),t.core.updateBeatLength(),t.core.recalcBeatIndex(),t.updateWaveform()})["catch"](function(e){console.log(e),t.alert("Couldn't load song! Is it a LAME encoded MP3?")})}}},{key:"removeAudio",value:function(e){var t=this;this.song&&(this.song[e._sound]=null,this.song[e._rhythm]="",this.setIndependentBuild(!0),this.reflow(e,""),this.song.sound&&this.linked?this.core.soundManager.playSong(this.song,!0,!0).then(function(){t.updateWaveform()}):(this.core.soundManager.stop(),this.updateWaveform()),this.updateInfo(),this.updateHalveDoubleButtons(e))}},{key:"blobToArrayBuffer",value:function(e){return new Promise(function(t,i){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=function(){i(new Error("File read failed!"))},n.readAsArrayBuffer(e)})}},{key:"newSong",value:function(e){e||(e={name:"Name",title:"Title",rhythm:"",source:"",sound:null,enabled:!0,filename:null,charsPerBeat:null,independentBuild:!0},this.respack||(this.respack=new Respack,this.respack.name="Editor Respack",this.respack.author="You!",this.respack.description="An internal resourcepack for editing new songs",this.core.resourceManager.addPack(this.respack)),this.respack.songs.push(e),this.core.resourceManager.rebuildArrays(),this.core.resourceManager.rebuildEnabled(),this.core.setSongOject(e)),this.buildEdit._hilight.className="beat-hilight invisible",this.loopEdit._hilight.className="beat-hilight invisible",this.newSongBtn.classList.remove("hues-button--glow"),this.fromSongBtn.classList.remove("hues-button--glow"),this.title.disabled=!1,this.source.disabled=!1,this.clearUndoRedo(),this.song=e,this.reflow(this.buildEdit,e.buildupRhythm),this.reflow(this.loopEdit,e.rhythm),this.title.value=e.title,this.source.value=e.source,this.updateIndependentBuild(),this.setLocked(this.buildEdit,0),this.setLocked(this.loopEdit,0),this.linked=!0,this.updateInfo(),this.updateWaveform()}},{key:"updateIndependentBuild",value:function(){var e=!!this.song.buildup,t=!!this.song.sound;e!=t&&this.setIndependentBuild(!0)}},{key:"setIndependentBuild",value:function(e){if(this.song.independentBuild=e,!e){var t=this.loopEdit._locked&&this.buildEdit._locked;this.loopEdit._locked=0,this.buildEdit._locked=0,this.setText(this.loopEdit,this.getText(this.loopEdit)),t&&(this.loopEdit._locked=this.song.rhythm.length,this.buildEdit._locked=this.song.buildupRhythm.length)}this.updateInfo()}},{key:"batchUndo",value:function(){this.batchUndoArray||(this.batchUndoArray=[])}},{key:"commitUndo",value:function(){this.batchUndoArray&&(this.undoBuffer.push(this.batchUndoArray),this.trimUndo(),this.batchUndoArray=null,this.updateUndoUI())}},{key:"pushUndo",value:function(e,t,i,n){if(i!=n){this.redoBuffer=[];var s={songVar:e,editor:t,text:i,indep:this.song.independentBuild};this.batchUndoArray?this.batchUndoArray.push(s):(this.undoBuffer.push([s]),this.trimUndo()),this.updateUndoUI()}}},{key:"trimUndo",value:function(){for(;this.undoBuffer.length>50;)this.undoBuffer.shift()}},{key:"undo",value:function(){this.undoRedo(this.undoBuffer,this.redoBuffer)}},{key:"redo",value:function(){this.undoRedo(this.redoBuffer,this.undoBuffer)}},{key:"undoRedo",value:function(e,t){if(0!==e.length&&this.song){for(var i=e.pop(),n=[],s=0;s<i.length;s++){var a=i[s];n.push({songVar:a.songVar,editor:a.editor,text:this.song[a.songVar],indep:this.song.independentBuild}),this.song[a.songVar]=a.text,this.song.independentBuild=a.indep,a.editor._locked&&(a.editor._locked=a.text.length),this.reflow(a.editor,this.song[a.songVar]),this.updateHalveDoubleButtons(a.editor)}t.push(n),this.updateUndoUI(),this.updateInfo(),this.core.updateBeatLength(),this.core.recalcBeatIndex()}}},{key:"clearUndoRedo",value:function(){this.undoBuffer=[],this.redoBuffer=[],this.updateUndoUI()}},{key:"updateUndoUI",value:function(){this.undoBtn.className="hues-button hues-button--disabled",this.redoBtn.className="hues-button hues-button--disabled",this.undoBuffer.length>0&&this.undoBtn.classList.remove("hues-button--disabled"),this.redoBuffer.length>0&&this.redoBtn.classList.remove("hues-button--disabled")}},{key:"halveBeats",value:function(e){var t=!1;if(!this.song.independentBuild){t=!0,this.batchUndo();var i=this.getOther(e);this.song.independentBuild=!0,this.halveBeats(i)}this.setText(e,this.song[e._rhythm].replace(/(.)./g,"$1")),t&&(this.commitUndo(),this.setIndependentBuild(!1))}},{key:"doubleBeats",value:function(e){var t=!1;if(!this.song.independentBuild){t=!0,this.batchUndo();var i=this.getOther(e);this.song.independentBuild=!0,this.doubleBeats(i)}this.setText(e,this.song[e._rhythm].replace(/(.)/g,"$1.")),t&&(this.commitUndo(),this.setIndependentBuild(!1))}},{key:"updateHalveDoubleButtons",value:function(e){if(e._halveBtn.className="hues-button hues-button--disabled",e._doubleBtn.className="hues-button hues-button--disabled",!e._locked){var t=this.getText(e).length;if(!this.song.independentBuild){var i=this.getOther(e);t=Math.min(t,this.getText(i).length)}t>0&&(e._doubleBtn.className="hues-button"),t>1&&(e._halveBtn.className="hues-button")}}},{key:"createTextInput",value:function(e,i,n){var s=t.createElement("div");s.className="editor__label";var a=t.createElement("label");a.innerHTML=e,s.appendChild(a);var o=t.createElement("span");o.className="editor__textinput-container";var h=t.createElement("input");return h.className="editor__textinput",h.type="text",h.value=i,o.appendChild(h),s.appendChild(o),n.appendChild(s),h}},{key:"createButton",value:function(e,i,n,s){var a=t.createElement("span");return a.className="hues-button",n&&a.classList.add("hues-button--disabled"),s&&(a.className+=" "+s),a.addEventListener("click",function(e){return!a.classList.contains("hues-button--disabled")||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)}),a.innerHTML=e.toUpperCase(),i.appendChild(a),a}},{key:"uiCreateInfo",value:function(){var e=t.createElement("div");this.topBar.appendChild(e),e.className="editor__info";var i=function(e){this.song&&(this.song[e]=this[e].value,this.song==this.core.currentSong&&this.core.callEventListeners("newsong",this.song))};this.title=this.createTextInput("Title:","Song name",e),this.title.oninput=i.bind(this,"title"),this.title.disabled=!0,this.source=this.createTextInput("Link:&nbsp;","Source link",e),this.source.oninput=i.bind(this,"source"),this.source.disabled=!0}},{key:"uiCreateImport",value:function(){var e=this,i=t.createElement("div");this.topBar.appendChild(i),i.className="editor__imports";var n=t.createElement("div");i.appendChild(n);var s=this.createButton("New song",n,!1,"hues-button--glow");s.addEventListener("click",function(){e.newSong()}),this.newSongBtn=s;var a=this.createButton("Edit current song",n,!1,"hues-button--glow");a.addEventListener("click",function(){e.core.currentSong&&e.newSong(e.core.currentSong)}),this.fromSongBtn=a;var o=t.createElement("div");o.className="settings-individual editor__song-stats",i.appendChild(o),this.loopLen=this.uiCreateSongStat("Loop length (s):","0.00",o),this.buildLen=this.uiCreateSongStat("Build length (s):","0.00",o),this.beatLen=this.uiCreateSongStat("Beat length (ms):","0.00",o)}},{key:"uiCreateSongStat",value:function(e,i,n){var s=t.createElement("div");n.appendChild(s);var a=t.createElement("span");a.textContent=e,s.appendChild(a);var o=t.createElement("span");return o.textContent=i,o.className="editor__song-stats__value",s.appendChild(o),o}},{key:"uiCreateEditArea",value:function(){var e=this,i=t.createElement("div");this.editArea=i,i.className="edit-area",this.root.appendChild(i),this.timeLock=t.createElement("div"),i.appendChild(this.timeLock),this.timeLock.className="hues-icon edit-area__timelock edit-area__timelock--unlocked";var n=this.createButton("&#xe904;",this.timeLock);n.addEventListener("click",function(){e.song&&e.song.buildup&&e.song.sound&&e.setIndependentBuild(!e.song.independentBuild)}),this.timeLock._locker=n,this.buildEdit=this.uiCreateSingleEditor("Buildup","buildup","buildupRhythm",i),this.seekStart=this.buildEdit._seek,this.seekStart.innerHTML="&#xe90b;",this.seekStart.addEventListener("click",function(){e.core.soundManager.seek(-e.core.soundManager.buildLength)});var s=t.createElement("div");s.className="resize-handle",i.appendChild(s);var a=t.createElement("div");a.className="hues-icon resize-handle__handle",a.innerHTML="&#xe908;",s.appendChild(a),this.resizeHandle=s,s.addEventListener("mousedown",function(i){i.preventDefault();var n=e.editArea.getBoundingClientRect().top,s=e.resizeHandle.clientHeight,a=function(t){e.buildEditSize=Math.floor(t.clientY-n+s/2),e.resize(!0)},o=function h(e){t.removeEventListener("mousemove",a),t.removeEventListener("mouseup",h)};t.addEventListener("mousemove",a),t.addEventListener("mouseup",o)}),this.loopEdit=this.uiCreateSingleEditor("Rhythm&nbsp;","sound","rhythm",i),this.seekLoop=this.loopEdit._seek,this.seekLoop.innerHTML="&#xe90b;",this.seekLoop.addEventListener("click",function(){e.core.soundManager.seek(0)}),this.buildEdit._hilight.textContent="[none]",this.loopEdit._hilight.innerHTML='<br />Click [LOAD RHYTHM] to load a loop! LAME encoded MP3s work best.<br />(LAME is important for seamless MP3 loops)<br /><br />[DOUBLE] doubles the selected map length by padding it with "."s.<br />[HALVE] shortens the map length by removing every other character.<br /><br />You can also add a buildup with [LOAD BUILDUP], or remove it<br />with [REMOVE].<br /><br />[NEW SONG] adds a completely empty song for you to edit, and<br />[EDIT CURRENT SONG] takes the current playing song to the editor.<br /><br />[COPY/SAVE XML] allow for storing the rhythms and easy <br />inclusion into a Resource Pack!'}},{key:"uiCreateSingleEditor",value:function(e,i,n,s){var a=this,o=t.createElement("div");s.appendChild(o);var h=t.createElement("div");h.className="edit-area__header",o.appendChild(h);var r=t.createElement("span");h.appendChild(r),r.innerHTML=e;var d=this.createButton("",h,!0,"hues-icon");h.appendChild(d),o._seek=d;var l=t.createElement("span");h.appendChild(l),l.className="edit-area__beat-count",l.textContent="0 beats",o._lockedBtn=this.createButton("&#xe907;",h,!1,"hues-icon"),o._lockedBtn.addEventListener("click",function(){if(o._locked)a.setLocked(o,0);else{var e=a.getText(o).length;a.setLocked(o,e)}});var u=t.createElement("span");u.className="edit-area__header__right",h.appendChild(u),o._halveBtn=this.createButton("Halve",u,!0),o._halveBtn.addEventListener("click",this.halveBeats.bind(this,o)),o._doubleBtn=this.createButton("Double",u,!0),o._doubleBtn.addEventListener("click",this.doubleBeats.bind(this,o));var c=t.createElement("input");c.type="file",c.accept=".mp3, .wav, .ogg",c.multiple=!1,c.onchange=this.loadAudio.bind(this,o);var v=this.createButton("Load "+e.replace(/&nbsp;/g,""),u);v.addEventListener("click",function(){c.click()}),o._removeBtn=this.createButton("Remove",u,!0),o._removeBtn.addEventListener("click",this.removeAudio.bind(this,o));var p=t.createElement("div");p.className="edit-area__box";var g=t.createElement("div");g.className="edit-area__beatmap",g.contentEditable=!0,g.spellcheck=!1,g.oninput=this.textUpdated.bind(this,o),g.oncontextmenu=this.rightClick.bind(this,o);var f=t.createElement("div");return f.className="beat-hilight",p.appendChild(f),p.appendChild(g),o.appendChild(p),o._header=h,o._beatCount=l,o._box=p,o._beatmap=g,o._hilight=f,o._fileInput=c,o._sound=i,o._rhythm=n,o._locked=0,o}},{key:"uiCreateControls",value:function(){var e=this,i=t.createElement("div");i.className="edit__controls",this.root.appendChild(i);var n=function(e){var t=this.core.soundManager.playbackRate;t+=e,this.core.soundManager.setRate(t);var i=this.core.soundManager.playbackRate;h.textContent=i.toFixed(2)+"x"},s=t.createElement("div");i.appendChild(s);var a=this.createButton("&#xe909;",s,!1,"hues-icon");a.addEventListener("click",n.bind(this,-.25));var o=this.createButton("&#xe90a;",s,!1,"hues-icon");o.addEventListener("click",n.bind(this,.25));var h=t.createElement("span");h.className="settings-individual",h.textContent="1.00x",s.appendChild(h);var r=t.createElement("div");i.appendChild(r);var d=t.createElement("span");d.className="settings-individual",d.textContent="New line at beat ",r.appendChild(d);var l=t.createElement("input");l.className="settings-input",l.value=this.wrapAt,l.type="text",l.oninput=function(){return l.value=l.value.replace(/\D/g,""),""===l.value||l.value<1?void(l.value=""):(e.wrapAt=parseInt(l.value),e.reflow(e.buildEdit,e.song.buildupRhythm),void e.reflow(e.loopEdit,e.song.rhythm))},r.appendChild(l)}},{key:"uiCreateVisualiser",value:function(){var e=t.createElement("canvas");e.className="waveform",e.height=n,this.root.appendChild(e),this.waveCanvas=e,this.waveContext=e.getContext("2d"),this.core.addEventListener("frame",this.drawWave.bind(this))}},{key:"rightClick",value:function(e,t){if(this.linked){var i=this.getTextCoords(t);if(i.x>this.wrapAt)return!0;var n=i.y*this.wrapAt+i.x,s=this.getText(e).length;if(n>s)return!0;this.setCaret(e._beatmap,n);var a=n/s,o=0;if(e==this.loopEdit)o=this.core.soundManager.loopLength*a;else{var h=this.core.soundManager.buildLength;o=-h+h*a}return this.core.soundManager.seek(o),t.preventDefault(),!1}}},{key:"getTextCoords",value:function(e){for(var t=e.target,i=0,n=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)i+=t.offsetLeft-t.scrollLeft,n+=t.offsetTop-t.scrollTop,t=t.offsetParent;return i=Math.floor((e.clientX-i)/this.hilightWidth),n=Math.floor((e.clientY-n)/this.hilightHeight),{x:i,y:n}}},{key:"textUpdated",value:function(e){if(!this.song||!this.song[e._sound])return void this.reflow(e,"");var t=e._beatmap.textContent.replace(/ |\u00a0/g,"");0===t.length&&(t="."),this.setText(e,t)}},{key:"getText",value:function(e){return this.song&&this.song[e._rhythm]?this.song[e._rhythm]:""}},{key:"setText",value:function(t,i,n){if(!this.song||!this.song[t._sound])return void this.reflow(t,"");var s=!1,a=n?i.length:this.getCaret(t._beatmap);if(t._locked)if(a=Math.min(t._locked,a),i.length>t._locked)i=i.slice(0,a)+i.slice(a+(i.length-t._locked),i.length);else for(;i.length<t._locked;)i+=".";else if(!this.song.independentBuild&&this.song.buildupRhythm&&this.song.rhythm){var o=void 0;o=t==this.loopEdit?this.core.soundManager.loopLength/this.core.soundManager.buildLength:this.core.soundManager.buildLength/this.core.soundManager.loopLength;for(var h=Math.round(i.length/o);0===h;)i+=".",h=Math.round(i.length/o);var r=this.getOther(t),d=r._locked;r._locked=h,this.batchUndo(),s=!0,this.song.independentBuild=!0,this.setText(r,this.song[r._rhythm],!0),this.song.independentBuild=!1,d||(r._locked=0),this.updateHalveDoubleButtons(r)}this.pushUndo(t._rhythm,t,this.song[t._rhythm],i),s&&this.commitUndo(),e.onbeforeunload=this.confirmLeave,this.song[t._rhythm]=i,this.reflow(t,this.song[t._rhythm]),this.setCaret(t._beatmap,a),this.updateHalveDoubleButtons(t),this.core.updateBeatLength(),this.core.recalcBeatIndex(),this.updateInfo()}},{key:"getCaret",value:function(t){var i=0,n=e.getSelection();if(n.rangeCount)for(var s=n.getRangeAt(0),a=0;a<t.childNodes.length;a++){if(s.commonAncestorContainer==t.childNodes[a])return i+=s.endOffset;i+=t.childNodes[a].textContent.length}return 0}},{key:"setCaret",value:function(i,n){for(var s=t.createRange(),a=e.getSelection(),o=0;o<i.childNodes.length;o+=2){var h=i.childNodes[o].textContent.length;if(!(n>h)){s.setStart(i.childNodes[o],n),s.collapse(!0),a.removeAllRanges(),a.addRange(s);break}n-=h}}},{key:"setLocked",value:function(e,t){if(e._locked=t,t?e._lockedBtn.innerHTML="&#xe906;":e._lockedBtn.innerHTML="&#xe907;",!this.song.independentBuild){var i=this.getOther(e),n=t?this.getText(i).length:0;this.song.independentBuild=!0,this.setLocked(i,n),this.song.independentBuild=!1}this.updateHalveDoubleButtons(e)}},{key:"updateWaveform",value:function(){this.buildWaveBuff!=this.core.soundManager.buildup&&(this.buildWaveBuff=this.core.soundManager.buildup,this.buildWave=this.renderWave(this.buildWaveBuff,this.core.soundManager.buildLength)),this.loopWaveBuff!=this.core.soundManager.loop&&(this.loopWaveBuff=this.core.soundManager.loop,this.loopWave=this.renderWave(this.loopWaveBuff,this.core.soundManager.loopLength))}},{key:"renderWave",value:function(e,s){if(!e)return null;var a=t.createElement("canvas"),o=a.getContext("2d");a.height=n,a.width=Math.floor(i*s);for(var h=Math.floor(e.sampleRate/i),r=[],d=0;d<e.numberOfChannels;d++)r.push(e.getChannelData(d));for(var l=e.numberOfChannels,u=.5,c=n/2,v=0;v<e.length;v+=h){var p=0,g=0,f=0,b=0,m=void 0;for(m=0;m<h&&v+m<e.length;m++)for(var k=0;k<l;k++){var y=r[k][v+m];y>0?f+=y:b+=y,y>g&&(g=y),y<p&&(p=y)}var _=Math.floor(c+g*c),E=Math.floor(c+p*c);o.strokeStyle="black",o.globalAlpha="1",o.beginPath(),o.moveTo(u,_),o.lineTo(u,E),o.stroke(),f/=m*l,b/=m*l;var B=Math.floor(c+f*c),L=Math.floor(c+b*c);o.strokeStyle="white",o.globalAlpha="0.5",o.beginPath(),o.moveTo(u,B),o.lineTo(u,L),o.stroke(),u+=1}return a}},{key:"drawWave",value:function(){if((this.buildWave||this.loopWave)&&this.linked){var e=this.waveCanvas.width,t=this.core.soundManager.currentTime,s=e/i/2,a=t-s,o=t+s,h=this.core.soundManager.buildLength,r=this.core.soundManager.loopLength,d=void 0,l=void 0;if(d=h?Math.max(a,-h):Math.max(a,0),l=Math.floor((d-a)*i),this.waveContext.clearRect(0,0,e,n),this.buildWave&&h&&a<0){var u=Math.floor((1-d/-h)*(this.buildWave.width-1));try{l=this.drawOneWave(this.buildWave,u,l,e)}catch(c){console.log(this.waveCanvas)}d=0}var v=[];if(this.loopWave&&r&&o>0)for(;l<e;){0===d&&v.push(l);var p=Math.floor(d/r*(this.loopWave.width-1));l=this.drawOneWave(this.loopWave,p,l,e),d=0}this.drawWaveBar("red",e/2);var g=!0,f=!1,b=void 0;try{for(var m,k=v[Symbol.iterator]();!(g=(m=k.next()).done);g=!0){var y=m.value;this.drawWaveBar("green",y)}}catch(c){f=!0,b=c}finally{try{!g&&k["return"]&&k["return"]()}finally{if(f)throw b}}}}},{key:"drawOneWave",value:function(e,t,i,s){var a=Math.min(s-i,e.width-t);return this.waveContext.drawImage(e,t,0,a,n,i,0,a,n),i+a}},{key:"drawWaveBar",value:function(e,t){this.waveContext.strokeStyle=e,this.waveContext.lineWidth=2,this.waveContext.beginPath(),this.waveContext.moveTo(t,0),this.waveContext.lineTo(t,n),this.waveContext.stroke()}},{key:"confirmLeave",value:function(){return"Unsaved beatmap - leave anyway?"}},{key:"alert",value:function(e){this.statusMsg.classList.remove("editor__status-msg--fade"),this.statusMsg.textContent=e;this.statusMsg.offsetWidth;this.statusMsg.classList.add("editor__status-msg--fade")}},{key:"generateXML",value:function(){if(!this.song)return null;var e='  <song name="'+this.song.name+'">\n';return e+="    <title>"+this.song.title+"</title>\n",this.song.source&&(e+="    <source>"+this.song.source+"</source>\n"),e+="    <rhythm>"+this.song.rhythm+"</rhythm>\n",this.song.buildup&&(e+="    <buildup>"+this.song.buildupName+"</buildup>\n",e+="    <buildupRhythm>"+this.song.buildupRhythm+"</buildupRhythm>\n",this.song.independentBuild&&(e+="    <independentBuild>true</independentBuild>\n")),e+="  </song>\n"}},{key:"saveXML",value:function(){var i=this.generateXML();if(i){var n="<songs>\n";n+=i,n+="</songs>\n";var s=t.createElement("a");s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),s.setAttribute("download","0x40Hues - "+this.song.name+".xml"),s.style.display="none",t.body.appendChild(s),s.click(),t.body.removeChild(s),e.onbeforeunload=null}}},{key:"copyXML",value:function(){var e=this.generateXML();if(e){var i=t.createElement("textarea");i.className="copybox",i.value=e,t.body.appendChild(i),i.select();var n=void 0;try{n=t.execCommand("copy")}catch(s){n=!1}t.body.removeChild(i),n?this.alert("Beatmap XML copied to clipboard!"):this.alert("Copy failed! Try saving instead")}}}]),s}();e.HuesEditor=s}(window,document);
"use strict";!function(e,a){function t(e,t,i){if(i.enableWindow){var r=((parseInt(e)/10).toFixed(1),a.createElement("div"));r.className="hues-ref";var h=i.huesName.replace("%VERSION%",e),c=a.createElement("div");c.className="hues-about",c.innerHTML="<h1>"+h+'</h1><h2>Adapted from the <a target="_blank" href="http://0x40hues.blogspot.com">0x40 Flash</a></h2><h2>Web-ified by <a target="_blank" href="https://github.com/mon">mon</a></h2><h3>With help from <a target="_blank" href="https://github.com/kepstin/0x40hues-html5">Kepstin</a></h3>',r.appendChild(c),l(r,"Beat glossary",n),l(r,"Keyboard shortcuts",o),t.addTab("INFO",r)}}var n=["x Vertical blur (snare)","o Horizontal blur (bass)","- No blur","+ Blackout","¤ Whiteout","| Short blackout",": Color only","* Image only","X Vertical blur only","O Horizontal blur only",") Trippy cirle in","( Trippy circle out","~ Fade color","= Fade and change image","i Invert all colours","I Invert & change image","s Horizontal slice","S Horizontal slice and change image","v Vertical slice","V Vertical slice and change image","# Double slice","@ Double slice and change image"],o=["↑↓  Change song","←→  Change image","[N] Random song","-+  Change volume","[M] Toggle mute","[B] Restart song from build","[F] Toggle automode","[H] Toggle UI hide","[C] Character list","[S] Song list","[W] Toggle window","[R] Resource packs","[O] Options","[I] Information","[1-5] Change UI"],l=function(e,t,n){var o=a.createElement("div");o.className="hues-ref__info",e.appendChild(o);var l=a.createElement("h3");l.textContent=t,o.appendChild(l);var i=a.createElement("ul");n.forEach(function(e){var t=a.createElement("li");t.textContent=e,i.appendChild(t)}),o.appendChild(i)};e.populateHuesInfo=t}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e,t){var n={workersPath:"lib/workers/",respacks:[],parseQueryString:!0,respackPath:"respacks/",load:!0,autoplay:!0,overwriteLocal:!1,firstSong:null,firstImage:null,fullAuto:!0,packsURL:"https://cdn.0x40.ga/getRespacks.php",disableRemoteResources:!1,enableWindow:!0,showWindow:!1,firstWindow:"INFO",preloadPrefix:"0x",preloadBase:16,preloadMax:64,preloadTitle:"",huesName:"0x40 Hues of JS, v%VERSION%",root:null,disableKeyboard:!1,smartAlign:"on",blurAmount:"medium",blurDecay:"fast",blurQuality:"medium",currentUI:"modern",colourSet:"normal",blackoutUI:"off",playBuildups:"on",visualiser:"off",shuffleImages:"on",autoSong:"off",autoSongDelay:5,autoSongShuffle:"on",autoSongFadeout:"on",trippyMode:"off",volume:.7,skipPreloader:"off"},a={Functionality:["autoSong","autoSongShuffle","autoSongFadeout","playBuildups"],Graphics:["blurAmount","blurDecay","blurQuality","trippyMode"],Visuals:["smartAlign","shuffleImages","colourSet","visualiser"],Interface:["currentUI","blackoutUI","skipPreloader"]},i={smartAlign:{name:"Smart Align images",options:["off","on"]},blurAmount:{name:"Blur amount",options:["low","medium","high"]},blurDecay:{name:"Blur decay",options:["slow","medium","fast","faster!"]},blurQuality:{name:"Blur quality",options:["low","medium","high","extreme"]},visualiser:{name:"Spectrum analyser",options:["off","on"]},currentUI:{name:"UI style",options:["retro","v4.20","modern","xmas","hlwn","mini"]},colourSet:{name:"Colour set",options:["normal","pastel","v4.20"]},blackoutUI:{name:"Blackout affects UI",options:["off","on"]},playBuildups:{name:"Play buildups",options:["off","once","on"]},autoSong:{name:"AutoSong",options:["off","loop","time",{type:"varText",text:function(){return"off"==this.autoSong?"":"after"}},{type:"input",variable:"autoSongDelay",inputType:"int",visiblity:function(){return"off"!=this.autoSong}},{type:"varText",text:function(){var e="";switch(this.autoSong){case"loop":e="loop";break;case"time":e="min";break;case"off":default:return""}return this.autoSongDelay>1&&(e+="s"),e}}]},autoSongShuffle:{name:"AutoSong shuffle",options:["off","on"]},autoSongFadeout:{name:"AutoSong fade out",options:["off","on"]},trippyMode:{name:"Trippy Mode",options:["off","on"]},shuffleImages:{name:"Shuffle images",options:["off","on"]},skipPreloader:{name:"Skip preloader warning",options:["off","on"]}},o=function(){function o(e){_classCallCheck(this,o),this.eventListeners={updated:[]};var t="1";localStorage.settingsVersion!=t&&(localStorage.clear(),localStorage.settingsVersion=t),this.hasUI=!1,this.settingCheckboxes={},this.textCallbacks=[],this.visCallbacks=[],this.ephemerals={};for(var a in n)n.hasOwnProperty(a)&&(Object.defineProperty(this,a,{set:this.makeSetter(a),get:this.makeGetter(a)}),void 0!==e[a]&&(e.overwriteLocal?this[a]=e[a]:this.ephemerals[a]=e[a]));if(this.parseQueryString){var i=this.getQuerySettings();for(var s in n)void 0!==i[s]&&"respacks"!=s&&(this.ephemerals[s]=i[s]);this.respacks=this.respacks.concat(i.respacks)}}return _createClass(o,[{key:"getQuerySettings",value:function(){var t={};t.respacks=[];for(var n=e.location.search.substring(1),a=n.split("&"),i=0;i<a.length;i++){var o=a[i].split("=");if("packs"==o[0]||"respacks"==o[0])for(var s=o[1].split(","),r=0;r<s.length;r++)t.respacks.push(this.respackPath+s[r]);else if("song"==o[0])t.firstSong=o[1];else{var l=o[1];"true"!==l&&"false"!==l||(l="true"==l),t[o[0]]=l}}return t}},{key:"initUI",value:function(e){var n=this,o=t.createElement("div");o.className="hues-options";var s=function(e,t){return this.value=this.value.replace(/\D/g,""),""===this.value||this.value<1?void(this.value=""):(e[t]=this.value,e.updateConditionals(),void e.callEventListeners("updated"))};for(var r in a)if(a.hasOwnProperty(r)){var l=t.createElement("div");l.textContent=r,l.className="settings-category";for(var u=a[r],c=function(e){var a=u[e],o=t.createElement("div"),r=i[a];o.textContent=r.name,o.className="settings-individual";var c=t.createElement("div");c.className="settings-buttons";for(var p=0;p<r.options.length;p++){var f=r.options[p];if("string"==typeof f){var h=t.createElement("input");n.settingCheckboxes[a+"-"+f]=h,h.className="settings-checkbox",h.type="radio",h.value=f;for(var v=0,d=a+"-"+f+"-";t.getElementById(d+v);)v++;h.name=a+"-"+v,h.id=d+v,n[a]==f&&(h.checked=!0),h.onclick=function(e){e[a]=this.value}.bind(h,n),c.appendChild(h);var m=t.createElement("label");m.className="settings-label",m.htmlFor=h.id,m.textContent=f.toUpperCase(),c.appendChild(m)}else if("varText"==f.type){var g=t.createElement("span");g.textContent=f.text.bind(n)(),c.appendChild(g),n.textCallbacks.push({func:f.text.bind(n),element:g})}else if("input"==f.type){var y=t.createElement("input");y.setAttribute("type","text"),y.className="settings-input",y.value=n[f.variable],"int"==f.inputType&&(y.oninput=s.bind(y,n,f.variable)),y.autofocus=!1,c.appendChild(y),f.visiblity&&(n.visCallbacks.push({func:f.visiblity.bind(n),element:y}),y.style.visibility=f.visiblity.bind(n)()?"visible":"hidden")}}o.appendChild(c),l.appendChild(o)},p=0;p<u.length;p++)c(p);o.appendChild(l)}e.addTab("OPTIONS",o),this.hasUI=!0}},{key:"makeGetter",value:function(e){var t=this;return function(){return n.hasOwnProperty(e)?void 0!==t.ephemerals[e]?t.ephemerals[e]:void 0!==localStorage[e]?localStorage[e]:n[e]:(console.log("WARNING: Attempted to fetch invalid setting:",e),null)}}},{key:"makeSetter",value:function(e){var t=this;return function(n){if(t.isEphemeral(e))t.ephemerals[e]=n;else{var a=i[e];if(!a||a.options.indexOf(n)==-1)return console.log(n,"is not a valid value for",e),!1;try{t.settingCheckboxes[e+"-"+n].checked=!0}catch(o){}localStorage[e]=n,t.ephemerals[e]=void 0}return t.updateConditionals(),t.callEventListeners("updated"),!0}}},{key:"isEphemeral",value:function(e){return void 0===i[e]}},{key:"updateConditionals",value:function(){for(var e=0;e<this.textCallbacks.length;e++){var t=this.textCallbacks[e];t.element.textContent=t.func()}for(var n=0;n<this.visCallbacks.length;n++){var a=this.visCallbacks[n];a.element.style.visibility=a.func()?"visible":"hidden"}}},{key:"callEventListeners",value:function(e){var t=Array.prototype.slice.call(arguments,1);this.eventListeners[e].forEach(function(e){e.apply(null,t)})}},{key:"addEventListener",value:function(e,t){if(e=e.toLowerCase(),"undefined"==typeof this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e=e.toLowerCase(),"undefined"==typeof this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e]=this.eventListeners[e].filter(function(e){return e!==t})}}]),o}();e.HuesSettings=o}(window,document);
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function e(t,i,s){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,s)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(s)},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();!function(e,t){var i=function(){function i(e,s){_classCallCheck(this,i),e&&(this.root=t.createElement("div"),this.root.className=s?s:this.constructor.name,e.appendChild(this.root),this.root.style.visibility="hidden",this.core=null,this.imageName=null,this.imageLink=null,this.songName=null,this.songLink=null,this.hueName=null,this.imagePrev=null,this.imageNext=null,this.songPrev=null,this.songNext=null,this.beatCount=null,this.timer=null,this.xBlur=null,this.yBlur=null,this.settingsToggle=null,this.hideToggle=null,this.callbacks=[],this.listContainer=null,this.visualiserContainer=null,this.hidden=!1,this.initUI())}return _createClass(i,[{key:"addCoreCallback",value:function(e,t){this.callbacks.push({name:e,func:t})}},{key:"initUI",value:function(){var e=this,i=t.createElement("div");this.imageName=i,this.imageLink=t.createElement("a"),this.imageLink.target="_blank",this.imageName.appendChild(this.imageLink);var s=t.createElement("div");this.songName=s,this.songLink=t.createElement("a"),this.songLink.target="_blank",this.songName.appendChild(this.songLink);var n=t.createElement("div");this.hueName=n;var a=t.createElement("div");a.textContent="<",a.onclick=function(){e.core.previousImage()},this.imagePrev=a;var o=t.createElement("div");o.textContent=">",o.onclick=function(){e.core.nextImage()},this.imageNext=o;var h=t.createElement("div");h.textContent="<",this.songPrev=h,h.onclick=function(){e.core.previousSong()};var l=t.createElement("div");l.textContent=">",l.onclick=function(){e.core.nextSong()},this.songNext=l;var r=t.createElement("div");r.textContent="SONGS",r.onclick=function(){e.core.toggleSongList()},this.songList=r;var c=t.createElement("div");c.textContent="IMAGES",c.onclick=function(){e.core.toggleImageList()},this.imageList=c,this.timer=t.createElement("div"),this.timer.textContent="T=$0x00000",this.beatCount=t.createElement("div"),this.beatCount.textContent="B=$0x0000",this.xBlur=t.createElement("div"),this.xBlur.textContent="X=$0x00",this.yBlur=t.createElement("div"),this.yBlur.textContent="Y=$0x00",this.settingsToggle=t.createElement("div"),this.settingsToggle.innerHTML="&#xe900;",this.settingsToggle.className="hues-icon",this.settingsToggle.onclick=function(){e.core.window.toggle()},this.hideToggle=t.createElement("div"),this.hideToggle.innerHTML="&#x25BC;",this.hideToggle.onclick=function(){e.toggleHide()},this.listContainer=t.createElement("div"),this.visualiserContainer=t.createElement("div"),this.addCoreCallback("newsong",this.newSong.bind(this)),this.addCoreCallback("newimage",this.newImage.bind(this)),this.addCoreCallback("newcolour",this.newColour.bind(this)),this.addCoreCallback("blurupdate",this.blurUpdated.bind(this)),this.addCoreCallback("time",this.updateTime.bind(this)),this.addCoreCallback("invert",this.invert.bind(this)),this.resizeHandler=this.resize.bind(this)}},{key:"connectCore",value:function(t){this.core=t,this.root.style.visibility="visible",t.resourceManager.hasUI&&this.listContainer.appendChild(t.resourceManager.listView),this.visualiserContainer.appendChild(this.core.visualiser),this.callbacks.forEach(function(e){t.addEventListener(e.name,e.func)}),e.addEventListener("resize",this.resizeHandler),this.resizeHandler()}},{key:"disconnect",value:function(){var t=this;for(this.callbacks.forEach(function(e){t.core.removeEventListener(e.name,e.func)}),this.core=null,this.root.style.visibility="hidden";this.listContainer.firstElementChild;)this.listContainer.removeChild(this.listContainer.firstElementChild);for(;this.visualiserContainer.firstElementChild;)this.visualiserContainer.removeChild(this.visualiserContainer.firstElementChild);e.removeEventListener("resize",this.resizeHandler)}},{key:"show",value:function(){this.root.style.visibility="visible"}},{key:"hide",value:function(){this.root.style.visibility="hidden"}},{key:"toggleHide",value:function(){this.hidden=!this.hidden,this.hidden?this.root.classList.add("hues-ui--hidden"):this.root.classList.remove("hues-ui--hidden")}},{key:"resize",value:function(){}},{key:"updateVolume",value:function(e){}},{key:"newSong",value:function(e){e&&(this.songLink.textContent=e.title.toUpperCase(),this.songLink.href=e.source)}},{key:"newImage",value:function(e){if(e){var t=e.fullname?e.fullname:e.name;this.imageLink.textContent=t.toUpperCase(),this.imageLink.href=e.source?e.source:""}}},{key:"newColour",value:function(e){this.hueName.textContent=e.n.toUpperCase()}},{key:"blurUpdated",value:function(e,t){e=Math.floor(255*e),t=Math.floor(255*t),this.xBlur.textContent="X="+this.intToHex(e,2),this.yBlur.textContent="Y="+this.intToHex(t,2)}},{key:"updateTime",value:function(e){e=Math.floor(1e3*e),this.timer.textContent="T="+this.intToHex(e,5)}},{key:"intToHex",value:function(e,t){for(var i=Math.abs(e).toString(16);i.length<t;)i="0"+i;var s=e<0?"-":"$";return s+"0x"+i}},{key:"invert",value:function(e){e?this.root.classList.add("inverted"):this.root.classList.remove("inverted")}}]),i}(),s=function(e){function i(e,t){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,t?t:"RetroUI"))}return _inherits(i,e),_createClass(i,[{key:"initUI",value:function(){var e=this;_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initUI",this).call(this);var s=t.createElement("div");s.className="hues-r-container",this.root.appendChild(s),this.container=s,this.mode=t.createElement("div"),s.appendChild(this.mode),s.appendChild(this.imageName),s.appendChild(this.timer),s.appendChild(this.beatCount),s.appendChild(this.xBlur),s.appendChild(this.yBlur),this.colourIndex=t.createElement("div"),this.colourIndex.textContent="C=$0x00",s.appendChild(this.colourIndex),this.version=t.createElement("div"),s.appendChild(this.version),s.appendChild(this.hueName),s.appendChild(this.songName),this.beatBar=t.createElement("div"),s.appendChild(this.beatBar),this.controls=t.createElement("div"),this.controls.className="hues-r-controls";var n=t.createElement("div");this.imageModeManual=t.createElement("div"),this.imageModeManual.textContent="NORMAL",this.imageModeManual.onclick=function(){e.core.setIsFullAuto(!1)},this.imageModeManual.className="hues-r-manualmode hues-r-button",this.imageModeAuto=t.createElement("div"),this.imageModeAuto.textContent="FULL AUTO",this.imageModeAuto.onclick=function(){e.core.setIsFullAuto(!0)},this.imageModeAuto.className="hues-r-automode hues-r-button",n.appendChild(this.imageModeManual),n.appendChild(this.imageModeAuto),this.imagePrev.className="hues-r-button",this.imageNext.className="hues-r-button",this.songPrev.className="hues-r-button",this.songNext.className="hues-r-button",this.controls.appendChild(this.imagePrev),this.controls.appendChild(n),this.controls.appendChild(this.imageNext),this.songList.className="hues-r-songs hues-r-button",this.controls.appendChild(this.songPrev),this.controls.appendChild(this.songList),this.controls.appendChild(this.songNext),this.root.appendChild(this.controls);var a=t.createElement("div");a.className="hues-r-subcontrols",a.appendChild(this.settingsToggle),this.imageList.textContent="C",a.appendChild(this.imageList),a.appendChild(this.hideToggle),this.subControls=a,this.root.appendChild(a),this.hideRestore=t.createElement("div"),this.hideRestore.className="hues-r-hiderestore",this.hideRestore.innerHTML="&#x25B2;",this.hideRestore.onclick=function(){e.toggleHide()},this.root.appendChild(this.hideRestore),this.listContainer.className="hues-r-listcontainer",this.root.appendChild(this.listContainer),this.visualiserContainer.className="hues-r-visualisercontainer",this.root.appendChild(this.visualiserContainer),this.addCoreCallback("beat",this.beat.bind(this)),this.addCoreCallback("newmode",this.newMode.bind(this))}},{key:"toggleHide",value:function(){this.hidden=!this.hidden,this.hidden?(this.subControls.classList.add("hues-ui--hidden"),this.controls.classList.add("hues-ui--hidden"),this.container.classList.add("hues-ui--hidden"),this.hideRestore.classList.add("hues-ui--hidden")):(this.subControls.classList.remove("hues-ui--hidden"),this.controls.classList.remove("hues-ui--hidden"),this.container.classList.remove("hues-ui--hidden"),this.hideRestore.classList.remove("hues-ui--hidden"))}},{key:"connectCore",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"connectCore",this).call(this,e),this.version.textContent="V=$"+e.versionHex}},{key:"newMode",value:function(e){this.mode.textContent="M="+(e?"FULL AUTO":"NORMAL")}},{key:"newImage",value:function(e){e&&(this.imageLink.textContent="I="+e.name.toUpperCase(),this.imageLink.href=e.source)}},{key:"newColour",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"newColour",this).call(this,e),this.colourIndex.textContent="C="+this.intToHex(this.core.colourIndex,2)}},{key:"beat",value:function(e,t){var i=e.slice(1);this.beatBar.textContent=">>"+i,this.beatCount.textContent="B="+this.intToHex(t,4)}},{key:"resize",value:function(){this.core.visualiser.width=this.visualiserContainer.offsetWidth,this.core.resizeVisualiser()}}]),i}(i),n=function(e){function t(e,i){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i?i:"MinimalUI"))}return _inherits(t,e),_createClass(t,[{key:"initUI",value:function(){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initUI",this).call(this),this.root.removeChild(this.controls),this.root.removeChild(this.subControls),this.container.removeChild(this.beatBar),this.container.innerHTML="",this.container.appendChild(this.beatBar)}}]),t}(s),a=function(i){function s(e,t){_classCallCheck(this,s);var i=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t?t:"WeedUI"));return i.xVariance=10,i.yVariance=20,i}return _inherits(s,i),_createClass(s,[{key:"initUI",value:function(){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"initUI",this).call(this),this.container.removeChild(this.beatBar),this.controls.className="hues-w-controls",this.subControls.className="hues-w-subcontrols";var e=t.createElement("div");e.className="hues-w-beatbar",this.root.appendChild(e),this.beatBar=e;var i=t.createElement("div");i.className="hues-w-beatleft",e.appendChild(i),this.beatLeft=i;var n=t.createElement("div");n.className="hues-w-beatright",e.appendChild(n),this.beatRight=n,this.imageModeManual.textContent="ONE",this.imageModeAuto.textContent="MANY",this.visualiserContainer.className+=" hues-w-visualisercontainer"}},{key:"toggleHide",value:function(){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"toggleHide",this).call(this,this),this.hidden?this.beatBar.classList.add("hues-ui--hidden"):this.beatBar.classList.remove("hues-ui--hidden")}},{key:"beat",value:function(i,s){var n=i.slice(1);if(this.beatLeft.textContent=n,this.beatRight.textContent=n,this.beatCount.textContent="B="+this.intToHex(s,4),["x","o","X","O"].indexOf(i[0])!=-1){var a=t.createElement("div");a.className="hues-w-beataccent";var o=this.round10(15-30*Math.random()),h=this.round10(-this.xVariance/2+Math.random()*this.xVariance),l=this.round10(30-this.yVariance/2+Math.random()*this.yVariance),r="rotate("+o+"deg) translate("+h+"px, "+l+"px)";a.style.MozTransform=r,a.style.webkitTransform=r,a.style.transform=r,a.textContent=i[0].toUpperCase(),this.root.appendChild(a),e.setTimeout(this.removeBeat.bind(this,a),1500)}}},{key:"round10",value:function(e){return Math.round(10*e)/10}},{key:"removeBeat",value:function(e){this.root.removeChild(e)}}]),s}(s),o=function(e){function i(e,t){_classCallCheck(this,i);var s=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,t?t:"ModernUI"));return s.textSize_normal=0,s.textSize_small=0,s.songLink_size=0,s.imageLink_size=0,s.currentBeat=".",s.hidden=0,s}return _inherits(i,e),_createClass(i,[{key:"initUI",value:function(){var e=this;_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initUI",this).call(this),this.imageName.className="hues-m-imagename",this.songName.className="hues-m-songtitle";var s=t.createElement("div");s.className="hues-m-controls",this.root.appendChild(s),this.controls=s,s.appendChild(this.imageName),s.appendChild(this.songName);var n=t.createElement("div");n.className="hues-m-leftbox",s.appendChild(n),this.leftBox=n,this.hueName.className="hues-m-huename",n.appendChild(this.hueName);var a=t.createElement("div");a.className="hues-m-vol-cluster",n.appendChild(a),this.settingsToggle.className+=" hues-m-cog",a.appendChild(this.settingsToggle),this.hideToggle.className="hues-m-hide",a.appendChild(this.hideToggle);var o=t.createElement("div");o.className="hues-m-vol-bar",this.volBar=o,a.appendChild(o);var h=t.createElement("div");h.textContent="VOL",h.className="hues-m-vol-label",h.onclick=function(){e.core.soundManager.toggleMute()},o.appendChild(h),this.volLabel=h,this.infoToggle=t.createElement("div"),this.infoToggle.innerHTML="?",this.infoToggle.className="hues-m-question",this.infoToggle.onclick=function(){e.core.window.selectTab("INFO")},a.appendChild(this.infoToggle);var l=t.createElement("input");l.type="range",l.min=0,l.max=1,l.step=.1,o.appendChild(l),this.volInput=l,l.oninput=function(){e.core.soundManager.setVolume(parseFloat(l.value))};var r=t.createElement("div");r.className="hues-m-rightbox",s.appendChild(r),this.rightBox=r;var c=t.createElement("div");c.className="hues-m-controlblock",this.songBlock=c,this.songList.className="hues-m-songbutton";var u=t.createElement("div");u.className="hues-m-controlbuttons",this.songPrev.className="hues-m-prevbutton",this.songNext.className="hues-m-nextbutton",this.songShuffle=t.createElement("div"),this.songShuffle.innerHTML="&#xe903;",this.songShuffle.className="hues-m-actbutton hues-icon",this.songShuffle.onclick=function(){e.core.randomSong()},c.appendChild(this.songList),u.appendChild(this.songPrev),u.appendChild(this.songShuffle),u.appendChild(this.songNext),c.appendChild(u),r.appendChild(c);var d=t.createElement("div");d.className="hues-m-controlblock",this.imageList.className="hues-m-songbutton",this.imageBlock=d;var m=t.createElement("div");m.className="hues-m-controlbuttons",this.imageMode=t.createElement("div"),this.imageMode.innerHTML="&#xe901;",this.imageMode.className="hues-m-actbutton hues-icon",this.imageMode.onclick=function(){e.core.toggleFullAuto()},this.imagePrev.className="hues-m-prevbutton",this.imageNext.className="hues-m-nextbutton",d.appendChild(this.imageList),m.appendChild(this.imagePrev),m.appendChild(this.imageMode),m.appendChild(this.imageNext),d.appendChild(m),r.appendChild(d);var g=t.createElement("div");g.className="hues-m-leftinfo";var p=t.createElement("div");p.className="hues-m-rightinfo",g.appendChild(this.xBlur),g.appendChild(this.yBlur),p.appendChild(this.timer),p.appendChild(this.beatCount),this.rightInfo=p,this.leftInfo=g,s.appendChild(g),s.appendChild(p),this.visualiserContainer.className="hues-m-visualisercontainer",s.appendChild(this.visualiserContainer);var v=t.createElement("div");v.className="hues-m-beatbar",this.root.appendChild(v),this.beatBar=v;var C=t.createElement("div");C.className="hues-m-beatleft",v.appendChild(C),this.beatLeft=C;var f=t.createElement("div");f.className="hues-m-beatright",v.appendChild(f),this.beatRight=f;var x=t.createElement("div");x.className="hues-m-beatcenter",this.root.appendChild(x),this.beatCenter=x,this.hideRestore=t.createElement("div"),this.hideRestore.className="hues-m-hiderestore",this.hideRestore.onclick=function(){e.toggleHide()},this.root.appendChild(this.hideRestore),this.listContainer.className="hues-m-listcontainer",this.root.appendChild(this.listContainer),this.addCoreCallback("beat",this.beat.bind(this)),this.addCoreCallback("newmode",this.newMode.bind(this))}},{key:"toggleHide",value:function(){switch(this.beatBar.classList.remove("hues-ui--hidden"),this.beatCenter.classList.remove("hues-ui--hidden"),this.controls.classList.remove("hues-ui--hidden"),this.hideRestore.classList.remove("hues-ui--hidden"),this.hidden){case 1:this.beatBar.classList.add("hues-ui--hidden"),this.beatCenter.classList.add("hues-ui--hidden");case 0:this.controls.classList.add("hues-ui--hidden"),this.hideRestore.classList.add("hues-ui--hidden")}this.hidden=(this.hidden+1)%3}},{key:"updateVolume",value:function(e){this.volInput.value=e,0===e?this.volLabel.textContent="(VOL)":this.volLabel.textContent="VOL"}},{key:"newMode",value:function(e){e?this.imageMode.innerHTML="&#xe902;":this.imageMode.innerHTML="&#xe901;"}},{key:"beat",value:function(e,t){this.currentBeat=e[0];var i=e.slice(1);if(this.beatLeft.textContent=i,this.beatRight.textContent=i,"."!=this.currentBeat){for(;this.beatCenter.firstElementChild;)this.beatCenter.removeChild(this.beatCenter.firstElementChild);var s=this.beatCenter.ownerDocument.createElement("span");s.textContent=this.currentBeat,this.beatCenter.appendChild(s)}this.beatCount.textContent="B="+this.intToHex(t,4)}},{key:"textWidth",value:function(e){for(var t=this.songLink,i=t.innerHTML,s="",n=0;n<100;n++)s+="&nbsp;";t.innerHTML=s,t.className=e;var a=t.offsetWidth/100;return t.innerHTML=i,a}},{key:"resize",value:function(){this.textSize_normal=this.textWidth(""),this.textSize_small=this.textWidth("small"),this.songLink_size=this.songName.clientWidth,this.imageLink_size=this.imageName.clientWidth,this.resizeSong(),this.resizeImage(),this.core.visualiser.width=this.controls.offsetWidth,this.core.resizeVisualiser()}},{key:"resizeElement",value:function(e,t){var i=e.textContent.length;i*this.textSize_normal<t?e.className="":i*this.textSize_small<t?e.className="small":e.className="x-small"}},{key:"resizeSong",value:function(){this.resizeElement(this.songLink,this.songLink_size)}},{key:"resizeImage",value:function(){this.resizeElement(this.imageLink,this.imageLink_size)}},{key:"newSong",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"newSong",this).call(this,e),e&&this.resizeSong()}},{key:"newImage",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"newImage",this).call(this,e),e&&this.resizeImage()}}]),i}(i),h=function(i){function s(e,i){_classCallCheck(this,s);var n=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,i?i:"XmasUI"));n.initSnow(),n.invert(!0),n.controls.removeChild(n.leftBox),n.controls.removeChild(n.rightBox),n.controls.removeChild(n.rightInfo),n.controls.removeChild(n.leftInfo),n.leftBox=null,n.rightBox=null,n.hueName=null,n.xBlur=null,n.yBlur=null,n.timer=null,n.controls.className+=" hues-x-controls",n.beatBar.className+=" hues-x-beatbar",n.lights=[];var a=t.createElement("div");a.className="hues-x-wires";var o=t.createElement("div");o.className="hues-x-wiresleft",r.forEach(function(e,t,i){var s=this.newLight(e,o);s.style.transform="rotate("+e.angle+"deg)",s.style.left=e.x+"px",s.style.top=e.y+"px",this.lights.push(s)},n);var h=t.createElement("div");h.className="hues-x-wiresright",c.forEach(function(e,t,i){var s=this.newLight(e,h);s.style.transform="rotate("+-e.angle+"deg)",s.style.right=e.x+"px",s.style.top=e.y+"px",this.lights.push(s)},n);var l=t.createElement("div");l.className="hues-x-wiresbottomhelper";var d=t.createElement("div");return d.className="hues-x-wiresbottom",u.forEach(function(e,t,i){var s=this.newLight(e,d);s.style.transform="rotate("+e.angle+"deg)",s.style.left=e.x+"px",s.style.bottom=e.y+"px",this.lights.push(s)},n),a.appendChild(o),a.appendChild(h),l.appendChild(d),a.appendChild(l),n.root.appendChild(a),n.visualiserContainer.className="hues-x-visualisercontainer",n.controls.removeChild(n.visualiserContainer),n.beatBar.appendChild(n.visualiserContainer),n}return _inherits(s,i),_createClass(s,[{key:"invert",value:function(e){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"invert",this).call(this,e),e?this.snowContext.fillStyle="rgba(0, 0, 0, 0.8)":this.snowContext.fillStyle="rgba(255, 255, 255, 0.8)"}},{key:"connectCore",value:function(e){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"connectCore",this).call(this,e),this.startSnow()}},{key:"disconnect",value:function(){this.stopSnow(),_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"disconnect",this).call(this)}},{key:"lightOn",value:function(e){e.on.className="hues-x-lighton",e.off.className="hues-x-lightoff"}},{key:"lightOff",value:function(e){e.on.className="hues-x-lighton off",e.off.className="hues-x-lightoff off"}},{key:"lightFadeOut",value:function(e){e.on.className="hues-x-lighton hues-x-fade off",e.off.className="hues-x-lightoff hues-x-fade off"}},{key:"lightRecolour",value:function(e){var t=Math.floor(7*Math.random())*-56;e.on.style.backgroundPosition=t+"px 0",e.off.style.backgroundPosition=t+"px 0"}},{key:"randomLight",value:function(e){Math.random()>=.5?this.lightOn(e):this.lightOff(e)}},{key:"newLight",value:function(e,i){var s=t.createElement("div");s.className="hues-x-light";var n=t.createElement("div"),a=t.createElement("div"),o=t.createElement("div");return n.appendChild(a),n.appendChild(o),s.appendChild(n),i.appendChild(s),s.on=a,s.off=o,s.bulb=n,this.randomLight(s),this.lightRecolour(s),s}},{key:"beat",value:function(e,t){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"beat",this).call(this,e,t),"."!=this.currentBeat&&this.lights.forEach(function(e,t,i){switch(this.currentBeat){case":":this.lightOn(e),this.lightRecolour(e);break;case"+":this.lightFadeOut(e);break;default:this.randomLight(e)}},this)}},{key:"initSnow",value:function(){this.snowCanvas=t.createElement("canvas"),this.snowContext=this.snowCanvas.getContext("2d"),this.snowCanvas.width=1280,this.snowCanvas.height=720,this.snowCanvas.style.display="none",this.snowCanvas.className="hues-canvas hues-x-snow",this.root.appendChild(this.snowCanvas),this.snowing=!1,this.maxSnow=30,this.snowAngle=0,this.lastSnow=0,this.snowflakes=[],this.addCoreCallback("frame",this.drawSnow.bind(this))}},{key:"startSnow",value:function(){this.snowing=!0,this.snowCanvas.style.display="block";var e=this.snowCanvas.height,t=this.snowCanvas.width;this.snowAngle=0,this.snowflakes=[];for(var i=0;i<this.maxSnow;i++)this.snowflakes.push({x:Math.random()*t,y:Math.random()*e,r:4*Math.random()+1,d:25*Math.random()});this.lastSnow=Date.now()/1e3}},{key:"stopSnow",value:function(){this.snowing=!1,this.snowCanvas.style.display="none"}},{key:"drawSnow",value:function(){var e=this.snowCanvas.width,t=this.snowCanvas.height,i=Date.now()/1e3,s=this.lastSnow-i;this.lastSnow=i,this.snowContext.clearRect(0,0,e,t),this.snowContext.beginPath();for(var n=0;n<this.maxSnow;n++){var a=this.snowflakes[n];this.snowContext.moveTo(a.x,a.y),this.snowContext.arc(a.x,a.y,a.r,0,2*Math.PI,!0)}this.snowContext.fill(),this.snowAngle+=s/6;for(var o=0;o<this.maxSnow;o++){var h=this.snowflakes[o];h.y+=Math.cos(this.snowAngle+h.d)+1+h.r/2,h.x+=2*Math.sin(this.snowAngle),(h.x>e+5||h.x<-5||h.y>t)&&(o%3>0?this.snowflakes[o]={x:Math.random()*e,y:-10,r:h.r,d:h.d}:Math.sin(this.snowAngle)>0?this.snowflakes[o]={x:-5,y:Math.random()*t,r:h.r,d:h.d}:this.snowflakes[o]={x:e+5,y:Math.random()*t,r:h.r,d:h.d})}}},{key:"resize",value:function(){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"resize",this).call(this);var t=e.innerWidth/e.innerHeight,i=this.snowContext.fillStyle;this.snowCanvas.width=Math.ceil(720*t),this.snowContext.fillStyle=i}},{key:"newColour",value:function(e){}},{key:"blurUpdated",value:function(e,t){}},{key:"updateTime",value:function(e){}}]),s}(o),l=function(e){function i(e,t){_classCallCheck(this,i);var s=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,t?t:"HalloweenUI"));return s.invert(!0),s}return _inherits(i,e),_createClass(i,[{key:"initUI",value:function(){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initUI",this).call(this),this.controls.className+=" hues-h-controls",this.beatBar.className+=" hues-h-beatbar",this.leftBox.className+=" hues-h-leftbox",this.rightBox.className+=" hues-h-rightbox",this.volBar.className+=" hues-h-vol-bar",this.beatLeft.className+=" hues-h-text",this.beatRight.className+=" hues-h-text",this.beatCenter.className+=" hues-h-text",this.songShuffle.className+=" hues-h-text",this.songNext.className+=" hues-h-text",this.songPrev.className+=" hues-h-text",this.songList.className+=" hues-h-text",this.songName.className+=" hues-h-text",this.imageMode.className+=" hues-h-text",this.imageNext.className+=" hues-h-text",this.imagePrev.className+=" hues-h-text",this.imageList.className+=" hues-h-text",this.imageName.className+=" hues-h-text",this.hueName.className+=" hues-h-text",this.settingsToggle.className+=" hues-h-text",this.hideToggle.className+=" hues-h-text",this.infoToggle.className+=" hues-h-text",this.volLabel.className+=" hues-h-text",this.timer.className="hues-h-textfade",this.beatCount.className="hues-h-textfade",this.xBlur.className="hues-h-textfade",this.yBlur.className="hues-h-textfade";var e=t.createElement("div");e.className="hues-h-tombstone",this.leftBox.appendChild(e);var s=t.createElement("div");s.className="hues-h-tombstone",this.songBlock.insertBefore(s,this.songBlock.firstChild);var n=t.createElement("div");n.className="hues-h-tombstone",this.imageBlock.insertBefore(n,this.imageBlock.firstChild);var a=t.createElement("div");a.className="hues-h-topleft";var o=t.createElement("div");o.className="hues-h-topright";var h=t.createElement("div");h.className="hues-h-bottomright",this.root.appendChild(a),this.root.appendChild(o),this.root.appendChild(h);var l=t.createElement("div");l.className="hues-h-left-hand",this.beatBar.appendChild(l);var r=t.createElement("div");r.className="hues-h-right-hand",this.beatBar.appendChild(r),this.vignette=t.createElement("div"),this.vignette.className="hues-h-vignette",this.root.appendChild(this.vignette)}},{key:"beat",value:function(e,t){if(_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"beat",this).call(this,e,t),"."!=this.currentBeat){var s=this.beatCenter.ownerDocument.createElement("div");s.className="hues-m-beatcenter hues-h-eyes",this.beatCenter.appendChild(s)}}},{key:"connectCore",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"connectCore",this).call(this,e),this.core.preloader.classList.add("hues-h-text")}},{key:"disconnect",value:function(){this.core.preloader.classList.remove("hues-h-text"),_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"disconnect",this).call(this)}}]),i}(o),r=[{angle:122.529582194,x:19.4,y:-19.35},{angle:92.5309436511,x:25.4,y:38.7},{angle:107.530202659,x:39.4,y:107.75},{angle:77.5309700777,x:20.75,y:184.8},{angle:77.5309700777,x:32.3,y:249.8},{angle:107.530202659,x:40.45,y:327.9},{angle:88.3307935055,x:35,y:410.9},{angle:107.530202659,x:54.35,y:490.95},{angle:74.9981580491,x:28.15,y:573.8},{angle:89.9973772074,x:23.45,y:675.35},{angle:107.530202659,x:21.65,y:762.6},{angle:107.530202659,x:15.8,y:842.75},{angle:92.5309436511,x:36.55,y:905.7},{angle:88.3307935055,x:31.1,y:988.7},{angle:107.530202659,x:50.45,y:1068.75},{angle:74.9981580491,x:45.75,y:1158.5},{angle:88.3307935055,x:35.85,y:1238.55}],c=[{angle:120.001009518,x:33.3,y:-29.75},{angle:90.0026227926,x:35.35,y:53.65},{angle:102.469029922,x:41.5,y:136.5},{angle:91.6692064945,x:22.15,y:216.55},{angle:72.4697973408,x:34.4,y:278.25},{angle:102.469029922,x:45.75,y:361.85},{angle:87.4699314665,x:26.65,y:426.35},{angle:72.4697973408,x:41.6,y:502.15},{angle:102.469029922,x:27.5,y:566},{angle:72.4697973408,x:7.65,y:638.45},{angle:102.469029922,x:11,y:721.25},{angle:76.1887724128,x:7.65,y:792.7},{angle:87.4690563489,x:36.15,y:850.35},{angle:102.46813454,x:16.6,y:924.3},{angle:72.4697973408,x:15.3,y:990.8},{angle:76.1887724128,x:11.95,y:1062.25},{angle:87.4690563489,x:40.45,y:1119.9},{angle:102.46813454,x:20.9,y:1193.85}],u=[{angle:32.5804579323,x:110.35,y:-12.1},{angle:3.28979777069,x:168.05,y:-5.55},{angle:17.6989154099,x:238.35,y:7.7},{angle:-12.6587029361,x:314.8,y:-10.4},{angle:-12.6587029361,x:379.4,y:1.05},{angle:17.6989154099,x:457.75,y:9.4},{angle:2.59102780115,x:540.6,y:3.75},{angle:17.6989154099,x:620.35,y:22.7},{angle:-15.134241831,x:703,y:-2.9},{angle:2.30443717424,x:804.75,y:-7.85},{angle:17.6989154099,x:892.45,y:-9.55},{angle:17.6989154099,x:971.65,y:-15.5},{angle:3.28979777069,x:1035.2,y:4.35},{angle:2.59102780115,x:1118,y:.2},{angle:17.6989154099,x:1198.05,y:18.95},{angle:-18.378894807,x:1288.2,y:14.2},{angle:-4.561224264,x:1367.9,y:4.6},{angle:32.5804579323,x:1452.6,y:-1.7},{angle:3.28979777069,x:1511.45,y:4.45},{angle:17.6989154099,x:1580.6,y:17.6},{angle:-12.6587029361,x:1656.6,y:-.95},{angle:-12.6587029361,x:1722.1,y:11.1},{angle:17.6989154099,x:1800.5,y:18.8},{angle:2.59102780115,x:1883.1,y:13},{angle:17.6989154099,x:1963,y:32.6},{angle:-15.134241831,x:2045.8,y:7},{angle:2.30443717424,x:2147.55,y:1.55},{angle:17.6989154099,x:2234.1,y:.4},{angle:17.6989154099,x:2315,y:-5.6},{angle:3.28979777069,x:2377.8,y:14.5},{angle:2.59102780115,x:2460.65,y:9.75},{angle:17.6989154099,x:2540.2,y:28.5},{angle:-18.378894807,x:2627.55,y:24.9},{angle:-4.561224264,x:2710.4,y:14.4}];e.RetroUI=s,e.WeedUI=a,e.ModernUI=o,e.XmasUI=h,e.HalloweenUI=l,e.MinimalUI=n}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();!function(e,t){var n=function(){function e(n,s){if(_classCallCheck(this,e),this.eventListeners={windowshown:[],tabselected:[]},this.hasUI=s.enableWindow,this.hasUI){this.window=t.createElement("div"),this.window.className="hues-win-helper",n.appendChild(this.window);var i=t.createElement("div");i.className="hues-win",this.window.appendChild(i);var a=t.createElement("div");a.className="hues-win__closebtn",a.onclick=this.hide.bind(this),i.appendChild(a),this.tabContainer=t.createElement("div"),this.tabContainer.className="hues-win__tabs",i.appendChild(this.tabContainer),this.contentContainer=t.createElement("div"),this.contentContainer.className="hues-win__content",i.appendChild(this.contentContainer),this.contents=[],this.tabs=[],this.tabNames=[],s.showWindow?this.show():this.hide()}}return _createClass(e,[{key:"addTab",value:function(e,n){if(this.hasUI){var s=t.createElement("div");s.textContent=e,s.className="tab-label",s.onclick=this.selectTab.bind(this,e),this.tabContainer.appendChild(s),this.tabs.push(s),this.tabNames.push(e);var i=t.createElement("div");i.className="tab-content",i.appendChild(n),this.contentContainer.appendChild(i),this.contents.push(i)}}},{key:"selectTab",value:function(e,t){if(this.hasUI){t||this.show();for(var n=0;n<this.tabNames.length;n++){var s=this.tabNames[n];e.toLowerCase()==s.toLowerCase()?(this.contents[n].classList.add("tab-content--active"),this.tabs[n].classList.add("tab-label--active"),this.callEventListeners("tabselected",s)):(this.contents[n].classList.remove("tab-content--active"),this.tabs[n].classList.remove("tab-label--active"))}}}},{key:"hide",value:function(){this.hasUI&&(this.window.classList.add("hidden"),this.callEventListeners("windowshown",!1))}},{key:"show",value:function(){this.hasUI&&(this.window.classList.remove("hidden"),this.callEventListeners("windowshown",!0))}},{key:"toggle",value:function(){this.hasUI&&(this.window.classList.contains("hidden")?this.show():this.hide())}},{key:"callEventListeners",value:function(e){var t=Array.prototype.slice.call(arguments,1);this.eventListeners[e].forEach(function(e){e.apply(null,t)})}},{key:"addEventListener",value:function(e,t){if(e=e.toLowerCase(),"undefined"==typeof this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e=e.toLowerCase(),"undefined"==typeof this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e]=this.eventListeners[e].filter(function(e){return e!==t})}}]),e}();e.HuesWindow=n}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}();!function(e,t){var s=0,a=1,i=0,n=function(){return i++},r=function(){function i(e,t){_classCallCheck(this,i),this.core=e,this.hasUI=!1,this.resourcePacks=[],this.allSongs=[],this.allImages=[],this.enabledSongs=[],this.enabledImages=[],this.progressState=[],this.progressCallback=null,this.listView=null,this.enabledSongList=null,this.enabledImageList=null,this.packView={pack:null,name:null,creator:null,size:null,desc:null,songCount:null,imageCount:null,songList:null,imageList:null,packButtons:null,totalSongs:null,totalImages:null},this.packsView={respackList:null,remoteList:null,loadRemote:null,progressBar:null,progressStatus:null,progressCurrent:null,progressTop:null,progressPercent:null},this.currentTab=s,this.unique=n(),this.remotes=null,this.fileInput=null,this.fileParseQueue=[],e.settings.enableWindow&&(this.initUI(),t.addTab("RESOURCES",this.root))}return _createClass(i,[{key:"getSizes",value:function(e){var t=[];return e.forEach(function(e){var s=new Promise(function(t,s){var a=new XMLHttpRequest;a.open("HEAD",e,!0),a.onreadystatechange=function(){if(this.readyState==this.DONE){var e=parseInt(a.getResponseHeader("Content-Length"));t(e/1024/1024)}},a.onerror=function(){s(Error(req.status+": Could not fetch respack at "+e))},a.send()})["catch"](function(t){throw 1012==t.code?Error("Respack at URL "+e+" is restricted. Check CORS."):t});t.push(s)}),Promise.all(t)}},{key:"addAll",value:function(e,t){var s=this;t&&(this.progressCallback=t,this.progressState=Array.apply(null,Array(e.length)).map(Number.prototype.valueOf,0));for(var a=[],i=function(e,t,s){this.progressState[e]=t,this.updateProgress(s)},n=0;n<e.length;n++){var r=new Respack;a.push(r.loadFromURL(e[n],i.bind(this,n)))}return a.reduce(function(e,t){return e.then(function(){return t}).then(function(e){s.addPack(e)})},Promise.resolve())}},{key:"updateProgress",value:function(e){for(var t=0,s=0;s<this.progressState.length;s++)t+=this.progressState[s];t/=this.progressState.length,this.progressCallback(t,e)}},{key:"addPack",value:function(e){console.log("Added",e.name,"to respacks");var t=this.resourcePacks.length;this.resourcePacks.push(e),this.addResourcesToArrays(e),this.rebuildEnabled(),this.updateTotals();var s=this;this.appendListItem("respacks",e.name,"res"+t,this.packsView.respackList,function(){e.enabled=this.checked,s.rebuildEnabled()},function(e){this.selectPack(e)}.bind(this,t))}},{key:"addResourcesToArrays",value:function(e){this.allImages=this.allImages.concat(e.images),this.allSongs=this.allSongs.concat(e.songs)}},{key:"rebuildArrays",value:function(){this.allSongs=[],this.allImages=[],this.allAnimations=[];for(var e=0;e<this.resourcePacks.length;e++)this.addResourcesToArrays(this.resourcePacks[e])}},{key:"rebuildEnabled",value:function(){this.enabledSongs=[],this.enabledImages=[];for(var e=0;e<this.resourcePacks.length;e++){var t=this.resourcePacks[e];if(t.enabled===!0){for(var s=0;s<t.songs.length;s++){var a=t.songs[s];a.enabled&&this.enabledSongs.indexOf(a)==-1&&this.enabledSongs.push(a)}for(var i=0;i<t.images.length;i++){var n=t.images[i];n.enabled&&this.enabledImages.indexOf(n)==-1&&this.enabledImages.push(n)}}}if(this.hasUI){for(var r=this.enabledSongList;r.firstElementChild;)r.removeChild(r.firstElementChild);for(var l=this.enabledImageList;l.firstElementChild;)l.removeChild(l.firstElementChild);for(var o=0;o<this.enabledSongs.length;o++){var c=this.enabledSongs[o];this.appendSimpleListItem(c.title,r,function(e){this.core.setSong(e)}.bind(this,o))}for(var h=0;h<this.enabledImages.length;h++){var d=this.enabledImages[h];this.appendSimpleListItem(d.name,l,function(e){this.core.setImage(e),this.core.setIsFullAuto(!1)}.bind(this,h))}}this.updateTotals()}},{key:"removePack",value:function(e){var t=this.resourcePacks.indexOf(e);t!=-1&&(this.resourcePacks.splice(t,1),this.rebuildArrays(),this.rebuildEnabled())}},{key:"removeAllPacks",value:function(){this.resourcePacks=[],this.rebuildArrays(),this.rebuildEnabled()}},{key:"getSongNames",value:function(){for(var e=[],t=0;t<this.allSongs.length;t++)e.push(this.allSongs[t]);return e}},{key:"loadLocal",value:function(){var e=this;console.log("Loading local zip(s)");for(var t=this.fileInput.files,s=Promise.resolve(),a=function(a){var i=new Respack;s=s.then(function(){return i.loadFromBlob(t[a],function(t,s){e.localProgress(t,s)})}).then(function(t){e.addPack(t),e.localComplete()})},i=0;i<t.length;i++)a(i);return s.then(function(){console.log("Local respack parsing complete")})}},{key:"localProgress",value:function(e,t){this.hasUI&&(this.packsView.progressStatus.textContent="Processing...",this.packsView.progressBar.style.width=100*e+"%",this.packsView.progressCurrent.textContent=t.filesLoaded,this.packsView.progressTop.textContent=t.filesToLoad,this.packsView.progressPercent.textContent=Math.round(100*e)+"%")}},{key:"localComplete",value:function(t){var s=this.packsView.progressStatus;s.textContent="Complete",e.setTimeout(function(){s.textContent="Idle"},2e3),this.packsView.progressBar.style.width="100%",this.packsView.progressCurrent.textContent="0b",this.packsView.progressTop.textContent="0b",this.packsView.progressPercent.textContent="0%"}},{key:"initUI",value:function(){var e=this;this.root=t.createElement("div"),this.root.className="respacks";var i=t.createElement("div");i.className="respacks__manager";var n=t.createElement("div");n.textContent="Current respacks",n.className="respacks__header";var r=t.createElement("div");r.className="resource-list",this.packsView.respackList=r;var l=null,o=null;this.core.settings.disableRemoteResources||(l=t.createElement("div"),l.textContent="Remote respacks",l.className="respacks__header",o=t.createElement("div"),o.className="resource-list resource-list--fill",r.classList.add("resource-list--fill"),this.appendSimpleListItem("Click to load the list",o,this.loadRemotes.bind(this)),this.packsView.remoteList=o);var c=t.createElement("div");c.className="respacks-buttons";var h=t.createElement("div");h.className="hues-button hidden",h.textContent="LOAD REMOTE",h.onclick=this.loadCurrentRemote.bind(this);var d=t.createElement("div");d.className="hues-button",d.textContent="LOAD ZIPS",d.onclick=function(){e.fileInput.click()},c.appendChild(d),c.appendChild(h),this.packsView.loadRemote=h,this.fileInput=t.createElement("input"),this.fileInput.type="file",this.fileInput.accept="application/zip",this.fileInput.multiple=!0,this.fileInput.onchange=this.loadLocal.bind(this);var p=t.createElement("div");p.className="progress-container respacks-bottom-container";var u=t.createElement("div");u.className="progress-bar";var m=t.createElement("span");m.className="progress-bar--filled",u.appendChild(m);var k=t.createElement("div");k.textContent="Idle";var g=t.createElement("div");g.className="stat-text";var v=t.createElement("div");v.textContent="0b";var C=t.createElement("div");C.textContent="0b";var b=t.createElement("div");b.textContent="0%",g.appendChild(v),g.appendChild(C),g.appendChild(b),this.packsView.progressBar=m,this.packsView.progressStatus=k,this.packsView.progressCurrent=v,this.packsView.progressTop=C,this.packsView.progressPercent=b,p.appendChild(k),p.appendChild(u),p.appendChild(g),i.appendChild(n),i.appendChild(r),this.core.settings.disableRemoteResources||(i.appendChild(l),i.appendChild(o)),i.appendChild(c),i.appendChild(p);var f=t.createElement("div");f.className="respacks__display";var w=t.createElement("div");w.textContent="<select a respack>",w.className="respacks__header";var E=t.createElement("div");E.className="stat-text";var L=t.createElement("div"),V=t.createElement("a");V.className="unstyled-link",V.textContent="<author>",L.appendChild(V),E.appendChild(L);var I=t.createElement("div");I.textContent="0b",E.appendChild(I);var x=t.createElement("div");x.className="respack-description",x.textContent="<no description>";var S=t.createElement("div");S.className="respack-tab-container";var y=t.createElement("div");y.textContent="Songs:",y.className="respack-tab respack-tab--checked";var N=t.createElement("div");N.textContent="Images:",N.className="respack-tab";var R=t.createElement("div");R.className="resource-list respack-tab__content respack-tab__content--checked";var P=t.createElement("div");P.className="resource-list respack-tab__content",y.onclick=function(){y.classList.add("respack-tab--checked"),N.classList.remove("respack-tab--checked"),R.classList.add("respack-tab__content--checked"),P.classList.remove("respack-tab__content--checked"),e.currentTab=s},N.onclick=function(){N.classList.add("respack-tab--checked"),y.classList.remove("respack-tab--checked"),P.classList.add("respack-tab__content--checked"),R.classList.remove("respack-tab__content--checked"),e.currentTab=a};var T=t.createElement("div");T.className="respacks-buttons respacks-buttons--fill invisible";var A=t.createElement("div");A.textContent="ENABLE ALL",A.className="hues-button",A.onclick=this.enableAll.bind(this);var _=t.createElement("div");_.textContent="INVERT",_.className="hues-button",_.onclick=this.invert.bind(this);var B=t.createElement("div");B.textContent="DISABLE ALL",B.className="hues-button",B.onclick=this.disableAll.bind(this),T.appendChild(A),T.appendChild(_),T.appendChild(B);var O=t.createElement("div");O.className="respacks-bottom-container";var U=t.createElement("div");U.className="respacks-count-container";var z=t.createElement("span");z.textContent="Total Songs:";var D=t.createElement("span");D.className="respacks-counts",U.appendChild(z),U.appendChild(D);var M=t.createElement("div");M.className="respacks-count-container";var q=t.createElement("span");q.textContent="Total images:";var F=t.createElement("span");F.className="respacks-counts",M.appendChild(q),M.appendChild(F),O.appendChild(U),O.appendChild(M),this.packView.name=w,this.packView.creator=V,this.packView.size=I,this.packView.desc=x,this.packView.songCount=y,this.packView.imageCount=N,this.packView.songList=R,this.packView.imageList=P,this.packView.packButtons=T,this.packView.totalSongs=D,this.packView.totalImages=F,f.appendChild(w),f.appendChild(E),f.appendChild(x),S.appendChild(y),S.appendChild(N),f.appendChild(S),f.appendChild(R),f.appendChild(P),f.appendChild(T),f.appendChild(O),this.root.appendChild(i),this.root.appendChild(f),this.listView=t.createElement("div"),this.enabledSongList=t.createElement("div"),this.enabledSongList.className="resource-list respacks-enabledsongs hidden",this.enabledImageList=t.createElement("div"),this.enabledImageList.className="resource-list respacks-enabledimages hidden",this.listView.appendChild(this.enabledSongList),this.listView.appendChild(this.enabledImageList),this.hasUI=!0}},{key:"hideLists",value:function(){this.hasUI&&(this.enabledSongList.classList.add("hidden"),this.enabledImageList.classList.add("hidden"))}},{key:"toggleVisible",value:function(e,t){this.hasUI&&(e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden"),t.classList.add("hidden"))}},{key:"toggleSongList",value:function(){this.toggleVisible(this.enabledSongList,this.enabledImageList)}},{key:"toggleImageList",value:function(){this.toggleVisible(this.enabledImageList,this.enabledSongList)}},{key:"updateTotals",value:function(){this.hasUI&&(this.packView.totalSongs.textContent=this.enabledSongs.length+"/"+this.allSongs.length,this.packView.totalImages.textContent=this.enabledImages.length+"/"+this.allImages.length)}},{key:"truncateNum",value:function(e){return Math.round(100*e)/100}},{key:"selectPack",value:function(e){var t=this.resourcePacks[e];this.packView.pack=t,this.packView.packButtons.classList.remove("invisible"),this.packsView.loadRemote.classList.add("hidden"),this.packView.name.textContent=t.name,this.packView.creator.textContent=t.author,this.packView.creator.href=t.link?t.link:"";var s=t.size/1024;s<512?this.packView.size.textContent=this.truncateNum(s)+"kB":this.packView.size.textContent=this.truncateNum(s/1024)+"MB",this.packView.desc.textContent=t.description,this.packView.songCount.textContent="Songs: "+t.songs.length,this.packView.imageCount.textContent="Images: "+t.images.length;for(var a=this.packView.songList,i=this.packView.imageList;a.firstElementChild;)a.removeChild(a.firstElementChild);for(;i.firstElementChild;)i.removeChild(i.firstElementChild);for(var n=0;n<t.songs.length;n++){var r=t.songs[n];this.appendListItem("songs",r.title,"song"+n,a,this.selectResourceCallback(r),this.clickResourceCallback.bind(this,r,!0),r.enabled)}for(var l=0;l<t.images.length;l++){var o=t.images[l];this.appendListItem("images",o.name,"image"+l,i,this.selectResourceCallback(o),this.clickResourceCallback.bind(this,o,!1),o.enabled)}}},{key:"selectResourceCallback",value:function(e){var t=this;return function(){e.enabled=this.checked,t.rebuildEnabled()}}},{key:"clickResourceCallback",value:function(e,t){e.enabled||(e.enabled=!0,this.rebuildEnabled(),this.selectPack(this.resourcePacks.indexOf(this.packView.pack))),t?this.core.setSong(this.enabledSongs.indexOf(e)):(this.core.setImage(this.enabledImages.indexOf(e)),this.core.setIsFullAuto(!1))}},{key:"getEnabledTabContents",value:function(){var e=this.packView.pack;return e?this.currentTab==s?{arr:e.songs,elName:"song"}:{arr:e.images,elName:"image"}:null}},{key:"enableAll",value:function(){var e=this.getEnabledTabContents();if(e){for(var s=0;s<e.arr.length;s++)e.arr[s].enabled=!0,t.getElementById(e.elName+s+"-"+this.unique).checked=!0;this.rebuildEnabled()}}},{key:"disableAll",value:function(){var e=this.getEnabledTabContents();if(e){for(var s=0;s<e.arr.length;s++)e.arr[s].enabled=!1,t.getElementById(e.elName+s+"-"+this.unique).checked=!1;this.rebuildEnabled()}}},{key:"invert",value:function(){var e=this.getEnabledTabContents();if(e){for(var s=0;s<e.arr.length;s++)e.arr[s].enabled=!e.arr[s].enabled,t.getElementById(e.elName+s+"-"+this.unique).checked=e.arr[s].enabled;this.rebuildEnabled()}}},{key:"appendListItem",value:function(e,s,a,i,n,r,l){if(this.hasUI){void 0===l&&(l=!0);var o=t.createElement("div");o.className="respacks-listitem";var c=t.createElement("input");c.type="checkbox",c.name=e,c.value=s,c.id=a+"-"+this.unique,c.checked=l,c.onclick=n;var h=t.createElement("label");h.htmlFor=c.id;var d=t.createElement("span");d.textContent=s,d.onclick=r,o.appendChild(c),o.appendChild(h),o.appendChild(d),i.appendChild(o)}}},{key:"loadRemotes",value:function(){for(var e=this,t=this.packsView.remoteList;t.firstElementChild;)t.removeChild(t.firstElementChild);var s=this.appendSimpleListItem("Loading...",t),a=new XMLHttpRequest;a.open("GET",this.core.settings.packsURL,!0),a.responseType="json",a.onload=function(){a.response||a.onerror(),e.remotes=a.response,e.populateRemotes()},a.onerror=function(){s.textContent="Could not load list! Click to try again",s.onclick=e.loadRemotes.bind(e)},a.send()}},{key:"populateRemotes",value:function(){for(var e=this.packsView.remoteList;e.firstElementChild;)e.removeChild(e.firstElementChild);for(var t=0;t<this.remotes.length;t++)this.remotes[t].loaded=!1,this.appendSimpleListItem(this.remotes[t].name,e,function(e){this.selectRemotePack(e)}.bind(this,t))}},{key:"selectRemotePack",value:function(e){var t=this.remotes[e];this.packView.pack=t,this.packView.packButtons.classList.add("invisible"),this.packsView.loadRemote.classList.remove("hidden"),t.loaded?(this.packsView.loadRemote.classList.add("hues-button--loaded"),this.packsView.loadRemote.textContent="LOADED"):(this.packsView.loadRemote.classList.remove("hues-button--loaded"),this.packsView.loadRemote.textContent="LOAD REMOTE"),this.packView.name.textContent=t.name,this.packView.creator.textContent=t.author,this.packView.creator.href=t.link?t.link:"";var s=t.size/1024;s<512?this.packView.size.textContent=this.truncateNum(s)+"kB":this.packView.size.textContent=this.truncateNum(s/1024)+"MB",this.packView.desc.textContent=t.description,this.packView.songCount.textContent="Songs: "+t.songcount,this.packView.imageCount.textContent="Images: "+t.imagecount;for(var a=this.packView.songList,i=this.packView.imageList;a.firstElementChild;)a.removeChild(a.firstElementChild);for(;i.firstElementChild;)i.removeChild(i.firstElementChild);for(var n=0;n<t.songs.length;n++){var r=t.songs[n];this.appendSimpleListItem(r,a)}var l=t.songcount-t.songs.length;if(l>0){var o="... and "+l+" more song";l>1&&(o+="s"),this.appendSimpleListItem(o+".",a),this.appendSimpleListItem("Load the respack to show the rest!",a)}for(var c=0;c<t.images.length;c++){var h=t.images[c];this.appendSimpleListItem(h,i)}var d=t.imagecount-t.images.length;if(d>0){var p="... and "+d+" more image";d>1&&(p+="s"),this.appendSimpleListItem(p+".",i),this.appendSimpleListItem("Load the respack to show the rest!",i)}}},{key:"loadCurrentRemote",value:function(){var e=this,t=this.packView.pack;void 0===t.loaded||t.loaded||(t.loaded=!0,this.packsView.loadRemote.className="hues-button hues-button--loaded",this.packsView.loadRemote.textContent="LOADING",this.addAll([t.url],function(t,s){e.remoteProgress(t,s)}).then(this.remoteComplete.bind(this)))}},{key:"remoteProgress",value:function(e,t){e<.5?(this.packsView.progressStatus.textContent="Downloading...",this.packsView.progressCurrent.textContent=Math.round(t.downloaded/1024)+"b",this.packsView.progressTop.textContent=Math.round(t.size/1024)+"b",this.packsView.progressBar.style.width=2*e*100+"%",this.packsView.progressPercent.textContent=Math.round(2*e*100)+"%"):(this.packsView.progressStatus.textContent="Processing...",this.packsView.progressCurrent.textContent=t.filesLoaded,this.packsView.progressTop.textContent=t.filesToLoad,this.packsView.progressBar.style.width=2*(e-.5)*100+"%",this.packsView.progressPercent.textContent=Math.round(2*(e-.5)*100)+"%")}},{key:"remoteComplete",value:function(){var t=this.packsView.progressStatus;t.textContent="Complete",e.setTimeout(function(){t.textContent="Idle"},2e3),this.packsView.loadRemote.textContent="LOADED",this.packsView.progressBar.style.width="100%",this.packsView.progressCurrent.textContent="0b",this.packsView.progressTop.textContent="0b",this.packsView.progressPercent.textContent="0%"}},{key:"appendSimpleListItem",value:function(e,s,a){var i=t.createElement("div");i.className="respacks-listitem";var n=t.createElement("span");return n.textContent=e.replace(/&amp;/g,"&"),n.onclick=a,i.appendChild(n),s.appendChild(i),n}}]),i}();e.Resources=r}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e,t){function n(){a&&console.log.apply(e.console,arguments)}var a=!1,i=new RegExp("\\.(mp3|ogg|wav)$","i"),s=new RegExp("\\.(png|gif|jpg|jpeg)$","i"),o=(new RegExp("(.*?)_\\d+$"),function(){function e(){_classCallCheck(this,e),this.songs=[],this.songQueue=[],this.images=[],this.imageQueue=[],this.name="<no name>",this.author="<unknown>",this.description="<no description>",this.link=null,this.size=-1,this.downloaded=-1,this.enabled=!0,this._xmlQueue=[],this.totalFiles=-1,this.progressCallback=null,this.filesToLoad=0,this.filesLoaded=0,this.loadedFromURL=!1}return _createClass(e,[{key:"updateProgress",value:function(e){if(this.progressCallback){var t=this.filesLoaded/this.filesToLoad;this.loadedFromURL&&(t=t/2+.5),this.progressCallback("number"==typeof e?e:t,this)}}},{key:"loadFromURL",value:function(e,t){var n=this;return this.loadedFromURL=!0,t&&(this.progressCallback=t),this.getBlob(e).then(function(e){return n.loadFromBlob(e)})}},{key:"getBlob",value:function(e,t){var n=this;return t&&(this.progressCallback=t),new Promise(function(t,a){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){200==i.status?t(i.response):a(Error(i.status+": Could not fetch respack at "+e))},i.onerror=function(){a(Error(i.status+": Could not fetch respack at "+e))},i.onprogress=function(e){if(e.lengthComputable){n.size=e.total,n.downloaded=e.loaded;var t=e.loaded/e.total;n.progressCallback&&n.progressCallback(t/2,n)}},i.send()})["catch"](function(t){throw 1012==t.code?Error("Respack at URL "+e+" is restricted. Check CORS."):t})}},{key:"loadFromBlob",value:function(e,t){var n=this;return t&&(this.progressCallback=t),this.updateProgress(this.loadedFromURL?.5:0),new Promise(function(t,a){n.size=e.size;var i=new zip.fs.FS;i.importBlob(e,function(){t(i)},function(e){a(Error("Respack error:",e.toString()))})}).then(function(e){return n.parseZip(e)}).then(function(){return n})}},{key:"parseZip",value:function(e){var t=this,n=e.entries;this.totalFiles=0,this.filesToLoad=0,this.filesLoaded=0;for(var a=0;a<n.length;a++)!n[a].directory&&n[a].name&&(this.totalFiles++,this.parseFile(n[a]));return this.parseSongQueue().then(function(){return t.parseImageQueue()}).then(function(){return t.parseXML()}).then(function(){t._xmlQueue=[],console.log("Loaded",t.name,"successfully with",t.songs.length,"songs and",t.images.length,"images.")})}},{key:"parseFile",value:function(e){var t=e.name;t.match(i)?(this.songQueue.push(this.parseSong(e)),this.filesToLoad++):t.match(s)?(this.imageQueue.push(this.parseImage(e)),this.filesToLoad++):t.toLowerCase().endsWith(".xml")&&this._xmlQueue.push(this.loadXML(e))}},{key:"parseSong",value:function(e){var t=this,a=e.name.replace(i,"");if(n("parsing song: "+a),!this.containsSong(a)){var s={name:a,title:null,rhythm:null,source:null,sound:null,enabled:!0,filename:e.name,charsPerBeat:null},o=e.name.split(".").pop().toLowerCase(),r="";switch(o){case"mp3":r="audio/mpeg3";break;case"ogg":r="audio/ogg";break;case"wav":r="audio/wav";break;default:r="application/octet-stream"}return this.songs.push(s),new Promise(function(t,n){e.getBlob(r,function(e){t(e)})}).then(function(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.readAsArrayBuffer(e)})}).then(function(e){s.sound=e,t.filesLoaded++,t.updateProgress()})}var l=this.getSong(a);n("WARNING: Song",a,"already exists! Conflict with",a,"and",l.name)}},{key:"parseSongQueue",value:function(){return this.songQueue.reduce(function(e,t){return e.then(function(){return t})},Promise.resolve())}},{key:"parseImage",value:function(e){var t=void 0,n=e.name.replace(s,""),a=void 0;if(t=n.match(new RegExp("^(.*)_(\\d+)$")))a=this.getImage(t[1]),a||(a={name:t[1],fullname:t[1],align:"center",bitmaps:[],frameDurations:[33],source:null,enabled:!0,animated:!0,beatsPerAnim:null},this.images.push(a));else{if(this.containsImage(n)){var i=this.getImage(n);return void console.log("WARNING: Image",n,"already exists! Conflict with",e.name,"and",i.name)}a={name:n,fullname:n,bitmap:null,align:"center",source:null,enabled:!0,filename:e.name,animated:!1},this.images.push(a)}return this.loadImage(e,a)}},{key:"loadImage",value:function(e,t){var n=this,a=e.name.split(".").pop().toLowerCase(),i="";switch(a){case"png":i="image/png";break;case"gif":i="image/gif";break;case"jpg":case"jpeg":i="image/jpeg";break;default:i="application/octet-stream"}return new Promise(function(t,n){e.getData64URI(i,t)}).then(function(e){return n.filesLoaded++,n.updateProgress(),{bitmap:e,img:t}})}},{key:"parseImageQueue",value:function(){return this.imageQueue.reduce(function(e,t){return e.then(function(){return t}).then(function(e){if(e){var t=new Image;t.src=e.bitmap,e.img.animated?e.img.bitmaps.push(t):e.img.bitmap=t}})},Promise.resolve())}},{key:"loadXML",value:function(e){return new Promise(function(t,n){e.getText(function(e){e=e.replace(/&amp;/g,"&"),e=e.replace(/&/g,"&amp;");var n=new DOMParser,a=n.parseFromString(e,"text/xml");t(a)})})}},{key:"parseXML",value:function(){for(var e=this,t=0;t<this._xmlQueue.length;t++)this._xmlQueue[t]=this._xmlQueue[t].then(function(t){switch(t.documentElement.nodeName){case"songs":e.songs.length>0&&e.parseSongFile(t);break;case"images":e.images.length>0&&e.parseImageFile(t);break;case"info":e.parseInfoFile(t);break;default:console.log("XML found with no songs, images or info")}});return Promise.all(this._xmlQueue)}},{key:"parseSongFile",value:function(e){n(" - Parsing songFile");for(var t=[],a=e.documentElement.firstElementChild;a;a=a.nextElementSibling){var i=this.getSong(a.attributes[0].value);if(i){if(i.title=a.getTag("title"),i.title||(i.title="<no name>",n("  WARNING!",i.name,"has no title!")),i.rhythm=a.getTag("rhythm"),i.rhythm||(i.rhythm="..no..rhythm..",n("  WARNING!!",i.name,"has no rhythm!!")),i.buildupName=a.getTag("buildup"),i.buildupName){n("  Finding a buildup '"+i.buildupName+"' for ",i.name);var s=this.getSong(i.buildupName);s?(i.buildup=s.sound,i.buildupPlayed=!1,this.songs.splice(this.songs.indexOf(s),1)):n("  WARNING!","Didn't find a buildup '"+i.buildupName+"'!")}i.buildupRhythm=a.getTag("buildupRhythm"),i.independentBuild=a.getTag("independentBuild"),i.source=a.getTag("source"),i.charsPerBeat=parseFloat(a.getTag("charsPerBeat")),"PackShit"==this.name&&(i.forceTrim=!0),t.push(i),n("  [I] "+i.name,": '"+i.title+"' added to songs")}else n("  WARNING!","songs.xml: <song> element",+a.attributes[0].value+"- no song found")}for(var o=0;o<this.songs.length;o++)t.indexOf(this.songs[o])==-1&&n("  WARNING!","We have a file for",this.songs[o].name,"but no information for it");this.songs=t}},{key:"parseInfoFile",value:function(e){n(" - Parsing infoFile");var t=e.documentElement;this.name=t.getTag("name",this.name),this.author=t.getTag("author",this.author),this.description=t.getTag("description",this.description),this.link=t.getTag("link",this.link)}},{key:"parseImageFile",value:function(e){n(" - Parsing imagefile");for(var t=[],a=e.documentElement.firstElementChild;a;a=a.nextElementSibling){var i=this.getImage(a.attributes[0].value);if(i){i.fullname=a.getTag("fullname"),i.fullname||n("  WARNING!",i.name,"has no full name!"),i.source=a.getTag("source"),i.align=a.getTag("align",i.align),i.beatsPerAnim=parseFloat(a.getTag("beatsPerAnim")),i.syncOffset=parseFloat(a.getTag("syncOffset"));var s=a.getTag("frameDuration");if(s){i.frameDurations=[];for(var o=s.split(","),r=0;r<o.length;r++)i.frameDurations.push(parseInt(o[r]));for(;i.frameDurations.length<i.bitmaps.length;)i.frameDurations.push(i.frameDurations[i.frameDurations.length-1]);n("Frame durations:",i.frameDurations)}n("  [I] "+i.name,":",i.fullname,"added to images"),i.bitmap||i.bitmaps?t.push(i):n("  WARNING!!","Image",i.name,"has no bitmap nor animation frames!")}else n("  WARNING!","images.xml: no image '"+a.attributes[0].value+"' found")}for(var l=0;l<this.images.length;l++){var u=this.images[l];t.indexOf(u)==-1&&t.push(u)}t.sort(function(e,t){return e.name.localeCompare(t.name)}),this.images=t}},{key:"containsSong",value:function(e){return null!==this.getSong(e)}},{key:"containsImage",value:function(e){return null!==this.getImage(e)}},{key:"getSong",value:function(e){for(var t=0;t<this.songs.length;t++)if(e==this.songs[t].name)return this.songs[t];return null}},{key:"getImage",value:function(e){for(var t=0;t<this.images.length;t++)if(e==this.images[t].name)return this.images[t];return null}}]),e}());e.Respack=o,Element.prototype.getTag=function(e,t){var n=this.getElementsByTagName(e)[0];return n?n.textContent:t?t:null}}(window,document);
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t,e){for(var i=function(){function e(t){_classCallCheck(this,e),this.eventListeners={seek:[]},this.core=t,this.playing=!1,this.playbackRate=1,this.song=null,this.initPromise=null,this.lockedPromise=null,this.locked=!0,this.context=null,this.oggSupport=!1,this.buildSource=null,this.loopSource=null,this.buildup=null,this.loop=null,this.startTime=0,this.buildLength=0,this.loopLength=0,this.gainNode=null,this.mute=!1,this.lastVol=1,this.vReady=!1,this.vBars=0,this.vTotalBars=0,this.splitter=null,this.analysers=[],this.analyserArrays=[],this.logArrays=[],this.binCutoffs=[],this.linBins=0,this.logBins=0,this.maxBinLin=0}return _createClass(e,[{key:"callEventListeners",value:function(t){var e=Array.prototype.slice.call(arguments,1);this.eventListeners[t].forEach(function(t){t.apply(null,e)})}},{key:"addEventListener",value:function(t,e){if(t=t.toLowerCase(),"undefined"==typeof this.eventListeners[t])throw Error("Unknown event: "+t);this.eventListeners[t].push(e)}},{key:"removeEventListener",value:function(t,e){if(t=t.toLowerCase(),"undefined"==typeof this.eventListeners[t])throw Error("Unknown event: "+t);this.eventListeners[t]=this.eventListeners[t].filter(function(t){return t!==e})}},{key:"init",value:function(){var e=this;return this.initPromise||(this.initPromise=new Promise(function(i,n){try{t.AudioContext=t.AudioContext||t.webkitAudioContext,AudioContext.prototype.suspend=AudioContext.prototype.suspend||function(){return Promise.resolve()},AudioContext.prototype.resume=AudioContext.prototype.resume||function(){return Promise.resolve()},e.context=new t.AudioContext,e.gainNode=e.context.createGain(),e.gainNode.connect(e.context.destination)}catch(o){return void n(Error("Web Audio API not supported in this browser."))}i()}).then(function(){return new Promise(function(t,i){e.context.decodeAudioData(r,function(i){e.oggSupport=!0,t()},function(i){e.oggSupport=!1,t()})})}).then(function(){return new Promise(function(t,i){var n=void 0;try{n=e.createWorker()}catch(o){return console.log(o),void i(Error("Audio Worker cannot be started - correct path set in defaults?"))}var r=function(e){n.terminate(),t()};n.addEventListener("message",r,!1),n.addEventListener("error",function(){i(Error("Audio Worker cannot be started - correct path set in defaults?"))},!1),n.postMessage({ping:!0,ogg:e.oggSupport})})}).then(function(){e.locked="running"!=e.context.state})),this.initPromise}},{key:"unlock",value:function(){var e=this;return this.lockedPromise?this.lockedPromise:(this.lockedPromise=new Promise(function(i,n){var o=function r(){var n=e.context.createBuffer(1,1,22050),o=e.context.createBufferSource();o.buffer=n,o.connect(e.context.destination),o.start(0),t.removeEventListener("touchend",r),t.removeEventListener("click",r),e.core.clearMessage(),i()};t.addEventListener("touchend",o,!1),t.addEventListener("click",o,!1)}),this.lockedPromise)}},{key:"playSong",value:function(t,e,i){var n=this,o=Promise.resolve();return this.song!=t||i?(this.stop(),this.song=t,t&&t.sound?(this.gainNode.gain.cancelScheduledValues(0),this.setVolume(this.lastVol),this.mute&&this.setMute(!0),o=o.then(function(){return n.loadSong(t)}).then(function(e){return t!=n.song?Promise.reject("Song changed between load and play - this message can be ignored"):(n.buildup=e.buildup,n.buildLength=n.buildup?n.buildup.duration:0,n.loop=e.loop,n.loopLength=n.loop.duration,n.context.suspend())}).then(function(){return e?n.seek(-n.buildLength,!0):n.seek(0,!0),n.context.resume()}).then(function(){n.playing=!0})):o):o}},{key:"stop",value:function(t){this.playing&&(this.buildSource&&(this.buildSource.stop(0),this.buildSource.disconnect(),this.buildSource=null,t||(this.buildup=null)),this.loopSource.stop(0),this.loopSource.disconnect(),this.loopSource=null,t||(this.loop=null),this.vReady=!1,this.playing=!1,this.startTime=0)}},{key:"setRate",value:function(t){t=Math.max(Math.min(t,2),.25);var e=this.clampedTime;this.playbackRate=t,this.seek(e)}},{key:"seek",value:function(t,e){this.song&&(this.callEventListeners("seek"),t=Math.min(Math.max(t,-this.buildLength),this.loopLength),this.stop(!0),this.loop&&(this.loopSource=this.context.createBufferSource(),this.loopSource.buffer=this.loop,this.loopSource.playbackRate.value=this.playbackRate,this.loopSource.loop=!0,this.loopSource.loopStart=0,this.loopSource.loopEnd=this.loopLength,this.loopSource.connect(this.gainNode),t<0&&this.buildup?(this.buildSource=this.context.createBufferSource(),this.buildSource.buffer=this.buildup,this.buildSource.playbackRate.value=this.playbackRate,this.buildSource.connect(this.gainNode),this.buildSource.start(0,this.buildLength+t),this.loopSource.start(this.context.currentTime-t/this.playbackRate)):this.loopSource.start(0,t),this.startTime=this.context.currentTime-t/this.playbackRate,e||(this.playing=!0),this.initVisualiser(),this.core.recalcBeatIndex()))}},{key:"loadSong",value:function(t){if(t._loadPromise)return Promise.reject("Song changed between load and play - this message can be ignored");var e={loop:null,buildup:null},i=[this.loadBuffer(t,"sound").then(function(t){e.loop=t})];return t.buildup?i.push(this.loadBuffer(t,"buildup").then(function(t){e.buildup=t})):this.buildLength=0,t._loadPromise=Promise.all(i).then(function(){return t._loadPromise=null,e}),t._loadPromise}},{key:"loadBuffer",value:function(t,e){var i=this,n=t[e],o=new Uint8Array(n);if(this.oggSupport&&79==o[0]&&103==o[1]&&103==o[2]&&83==o[3]){var r=n.slice(0);return new Promise(function(t,e){i.context.decodeAudioData(n,function(e){t(e)},function(t){e(Error("decodeAudioData failed to load track"))})}).then(function(i){return t[e]=r,i})}return new Promise(function(o,r){var s=i.createWorker();s.addEventListener("error",function(){r(Error("Audio Worker failed to convert track"))},!1),s.addEventListener("message",function(n){var a=n.data;if(s.terminate(),t[e]=a.arrayBuffer,a.error)return void r(new Error(a.error));var l=i.audioBufFromRaw(a.rawAudio);o(l)},!1),s.postMessage({buffer:n,ogg:i.oggSupport},[n])})}},{key:"audioBufFromRaw",value:function(t){for(var e=t.array,i=t.channels,n=e.length/i,o=this.context.createBuffer(i,n,t.sampleRate),r=0;r<i;r++){var s=new Float32Array(e.buffer,r*n*4,n);"function"==typeof o.copyToChannel?o.copyToChannel(s,r,0):o.getChannelData(r).set(s)}return o}},{key:"createWorker",value:function(){return new Worker(this.core.settings.workersPath+"audio-worker.js")}},{key:"initVisualiser",value:function(t){t||(t=this.vTotalBars),this.vReady=!1,this.vTotalBars=t;for(var e=0;e<this.analysers.length;e++)this.analysers[e].disconnect();this.splitter&&(this.splitter.disconnect(),this.splitter=null),this.analysers=[],this.analyserArrays=[],this.logArrays=[],this.binCutoffs=[],this.linBins=0,this.logBins=0,this.maxBinLin=0,this.attachVisualiser()}},{key:"attachVisualiser",value:function(){if(this.playing&&!this.vReady){var t=this.loopSource.channelCount;this.splitter=this.context.createChannelSplitter(t),this.loopSource.connect(this.splitter),this.buildSource&&this.buildSource.connect(this.splitter),this.vBars=Math.floor(this.vTotalBars/t);for(var e=0;e<t;e++){var i=this.context.createAnalyser();try{i.fftSize=8192}catch(n){i.fftSize=2048}i.smoothingTimeConstant=.6,i.minDecibels=-70,i.maxDecibels=-25,this.analyserArrays.push(new Uint8Array(i.frequencyBinCount)),i.getByteTimeDomainData(this.analyserArrays[e]),this.splitter.connect(i,e),this.analysers.push(i),this.logArrays.push(new Uint8Array(this.vBars))}var o=this.analysers[0].frequencyBinCount,r=this.loopSource.buffer.sampleRate/o;this.maxBinLin=Math.floor(2e3/r),this.linBins=Math.min(this.maxBinLin,Math.floor(this.vBars/2));for(var s=(Math.floor(22e3/r),this.vBars-this.linBins),a=Math.log2(2e3),l=Math.log2(22e3)-a,u=0;u<s;u++){var A=u*(l/s)+a,h=Math.pow(2,A),c=Math.floor(h/r);this.binCutoffs.push(c)}this.vReady=!0}}},{key:"sumArray",value:function(t,e,i){for(var n=0,o=e;o<=i;o++)n+=t[o];return n/(i-e+1)}},{key:"getVisualiserData",value:function(){if(!this.vReady)return null;for(var t=0;t<this.analyserArrays.length;t++){var e=this.analyserArrays[t],i=this.logArrays[t];this.analysers[t].getByteFrequencyData(e);for(var n=0;n<this.linBins;n++){var o=Math.round(n*this.maxBinLin/this.linBins);i[n]=e[o]}i[this.linBins]=e[this.binCutoffs[0]];for(var r=this.linBins+1;r<this.vBars;r++){var s=r-this.linBins;i[r]=this.sumArray(e,this.binCutoffs[s-1],this.binCutoffs[s])}}return this.logArrays}},{key:"setMute",value:function(t){return!this.mute&&t&&(this.lastVol=this.gainNode.gain.value),t?this.gainNode.gain.value=0:this.gainNode.gain.value=this.lastVol,this.core.userInterface.updateVolume(this.gainNode.gain.value),this.mute=t,t}},{key:"toggleMute",value:function(){return this.setMute(!this.mute)}},{key:"decreaseVolume",value:function(){this.setMute(!1);var t=Math.max(this.gainNode.gain.value-.1,0);this.setVolume(t)}},{key:"increaseVolume",value:function(){this.setMute(!1);var t=Math.min(this.gainNode.gain.value+.1,1);this.setVolume(t)}},{key:"setVolume",value:function(t){this.gainNode.gain.value=t,this.lastVol=t,this.core.userInterface.updateVolume(t)}},{key:"fadeOut",value:function(t){this.mute||(this.gainNode.gain.setValueAtTime(this.lastVol,this.context.currentTime),this.gainNode.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+2)),setTimeout(t,2e3)}},{key:"currentTime",get:function(){return this.playing?(this.context.currentTime-this.startTime)*this.playbackRate:0}},{key:"clampedTime",get:function(){var t=this.currentTime;return t>0&&(t%=this.loopLength),t}}]),e}(),n="T2dnUwACAAAAAAAAAADFYgAAAAAAAMLKRdwBHgF2b3JiaXMAAAAAAUSsAAAAAAAAgLsAAAAAAAC4AU9nZ1MAAAAAAAAAAAAAxWIAAAEAAACcKCV2Dzv/////////////////MgN2b3JiaXMrAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMjAyMDMgKE9tbmlwcmVzZW50KQAAAAABBXZvcmJpcx9CQ1YBAAABABhjVClGmVLSSokZc5QxRplikkqJpYQWQkidcxRTqTnXnGusubUghBAaU1ApBZlSjlJpGWOQKQWZUhBLSSV0EjonnWMQW0nB1phri0G2HIQNmlJMKcSUUopCCBlTjCnFlFJKQgcldA465hxTjkooQbicc6u1lpZji6l0kkrnJGRMQkgphZJKB6VTTkJINZbWUikdc1JSakHoIIQQQrYghA2C0JBVAAABAMBAEBqyCgBQAAAQiqEYigKEhqwCADIAAASgKI7iKI4jOZJjSRYQGrIKAAACABAAAMBwFEmRFMmxJEvSLEvTRFFVfdU2VVX2dV3XdV3XdSA0ZBUAAAEAQEinmaUaIMIMZBgIDVkFACAAAABGKMIQA0JDVgEAAAEAAGIoOYgmtOZ8c46DZjloKsXmdHAi1eZJbirm5pxzzjknm3PGOOecc4pyZjFoJrTmnHMSg2YpaCa05pxznsTmQWuqtOacc8Y5p4NxRhjnnHOatOZBajbW5pxzFrSmOWouxeaccyLl5kltLtXmnHPOOeecc84555xzqhenc3BOOOecc6L25lpuQhfnnHM+Gad7c0I455xzzjnnnHPOOeecc4LQkFUAABAAAEEYNoZxpyBIn6OBGEWIacikB92jwyRoDHIKqUejo5FS6iCUVMZJKZ0gNGQVAAAIAAAhhBRSSCGFFFJIIYUUUoghhhhiyCmnnIIKKqmkoooyyiyzzDLLLLPMMuuws8467DDEEEMMrbQSS0211VhjrbnnnGsO0lpprbXWSimllFJKKQgNWQUAgAAAEAgZZJBBRiGFFFKIIaaccsopqKACQkNWAQCAAAACAAAAPMlzREd0REd0REd0REd0RMdzPEeUREmUREm0TMvUTE8VVdWVXVvWZd32bWEXdt33dd/3dePXhWFZlmVZlmVZlmVZlmVZlmVZgtCQVQAACAAAgBBCCCGFFFJIIaUYY8wx56CTUEIgNGQVAAAIACAAAADAURzFcSRHciTJkixJkzRLszzN0zxN9ERRFE3TVEVXdEXdtEXZlE3XdE3ZdFVZtV1Ztm3Z1m1flm3f933f933f933f933f93UdCA1ZBQBIAADoSI6kSIqkSI7jOJIkAaEhqwAAGQAAAQAoiqM4juNIkiRJlqRJnuVZomZqpmd6qqgCoSGrAABAAAABAAAAAAAomuIppuIpouI5oiNKomVaoqZqriibsuu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6LhAasgoAkAAA0JEcyZEcSZEUSZEcyQFCQ1YBADIAAAIAcAzHkBTJsSxL0zzN0zxN9ERP9ExPFV3RBUJDVgEAgAAAAgAAAAAAMCTDUixHczRJlFRLtVRNtVRLFVVPVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVNU3TNE0gNGQlAAAEAMBijcHlICElJeXeEMIQk54xJiG1XiEEkZLeMQYVg54yogxy3kLjEIMeCA1ZEQBEAQAAxiDHEHPIOUepkxI556h0lBrnHKWOUmcpxZhizSiV2FKsjXOOUketo5RiLC12lFKNqcYCAAACHAAAAiyEQkNWBABRAACEMUgppBRijDmnnEOMKeeYc4Yx5hxzjjnnoHRSKuecdE5KxBhzjjmnnHNSOieVc05KJ6EAAIAABwCAAAuh0JAVAUCcAIBBkjxP8jRRlDRPFEVTdF1RNF3X8jzV9ExTVT3RVFVTVW3ZVFVZljzPND3TVFXPNFXVVFVZNlVVlkVV1W3TdXXbdFXdlm3b911bFnZRVW3dVF3bN1XX9l3Z9n1Z1nVj8jxV9UzTdT3TdGXVdW1bdV1d90xTlk3XlWXTdW3blWVdd2XZ9zXTdF3TVWXZdF3ZdmVXt11Z9n3TdYXflWVfV2VZGHZd94Vb15XldF3dV2VXN1ZZ9n1b14Xh1nVhmTxPVT3TdF3PNF1XdV1fV13X1jXTlGXTdW3ZVF1ZdmXZ911X1nXPNGXZdF3bNl1Xll1Z9n1XlnXddF1fV2VZ+FVX9nVZ15Xh1m3hN13X91VZ9oVXlnXh1nVhuXVdGD5V9X1TdoXhdGXf14XfWW5dOJbRdX1hlW3hWGVZOX7hWJbd95VldF1fWG3ZGFZZFoZf+J3l9n3jeHVdGW7d58y67wzH76T7ytPVbWOZfd1ZZl93juEYOr/w46mqr5uuKwynLAu/7evGs/u+soyu6/uqLAu/KtvCseu+8/y+sCyj7PrCasvCsNq2Mdy+biy/cBzLa+vKMeu+UbZ1fF94CsPzdHVdeWZdx/Z1dONHOH7KAACAAQcAgAATykChISsCgDgBAI8kiaJkWaIoWZYoiqbouqJouq6kaaapaZ5pWppnmqZpqrIpmq4saZppWp5mmpqnmaZomq5rmqasiqYpy6ZqyrJpmrLsurJtu65s26JpyrJpmrJsmqYsu7Kr267s6rqkWaapeZ5pap5nmqZqyrJpmq6reZ5qep5oqp4oqqpqqqqtqqosW55nmproqaYniqpqqqatmqoqy6aq2rJpqrZsqqptu6rs+rJt67ppqrJtqqYtm6pq267s6rIs27ovaZppap5nmprnmaZpmrJsmqorW56nmp4oqqrmiaZqqqosm6aqypbnmaoniqrqiZ5rmqoqy6Zq2qppmrZsqqotm6Yqy65t+77ryrJuqqpsm6pq66ZqyrJsy77vyqruiqYpy6aq2rJpqrIt27Lvy7Ks+6JpyrJpqrJtqqouy7JtG7Ns+7pomrJtqqYtm6oq27It+7os27rvyq5vq6qs67It+7ru+q5w67owvLJs+6qs+ror27pv6zLb9n1E05RlUzVt21RVWXZl2fZl2/Z90TRtW1VVWzZN1bZlWfZ9WbZtYTRN2TZVVdZN1bRtWZZtYbZl4XZl2bdlW/Z115V1X9d949dl3ea6su3Lsq37qqv6tu77wnDrrvAKAAAYcAAACDChDBQashIAiAIAAIxhjDEIjVLOOQehUco55yBkzkEIIZXMOQghlJI5B6GUlDLnIJSSUgihlJRaCyGUlFJrBQAAFDgAAATYoCmxOEChISsBgFQAAIPjWJbnmaJq2rJjSZ4niqqpqrbtSJbniaJpqqptW54niqapqq7r65rniaJpqqrr6rpomqapqq7ruroumqKpqqrrurKum6aqqq4ru7Ls66aqqqrryq4s+8Kquq4ry7Jt68Kwqq7ryrJs27Zv3Lqu677v+8KRreu6LvzCMQxHAQDgCQ4AQAU2rI5wUjQWWGjISgAgAwCAMAYhgxBCBiGEkFJKIaWUEgAAMOAAABBgQhkoNGRFABAnAAAYQymklFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSCmllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSqmklFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimVUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFIKAJCKcACQejChDBQashIASAUAAIxRSinGnIMQMeYYY9BJKClizDnGHJSSUuUchBBSaS23yjkIIaTUUm2Zc1JaizHmGDPnpKQUW805h1JSi7HmmmvupLRWa64151paqzXXnHPNubQWa64515xzyzHXnHPOOecYc84555xzzgUA4DQ4AIAe2LA6wknRWGChISsBgFQAAAIZpRhzzjnoEFKMOecchBAihRhzzjkIIVSMOeccdBBCqBhzzDkIIYSQOecchBBCCCFzDjroIIQQQgcdhBBCCKGUzkEIIYQQSighhBBCCCGEEDoIIYQQQgghhBBCCCGEUkoIIYQQQgmhlFAAAGCBAwBAgA2rI5wUjQUWGrISAAACAIAclqBSzoRBjkGPDUHKUTMNQkw50ZliTmozFVOQORCddBIZakHZXjILAACAIAAgwAQQGCAo+EIIiDEAAEGIzBAJhVWwwKAMGhzmAcADRIREAJCYoEi7uIAuA1zQxV0HQghCEIJYHEABCTg44YYn3vCEG5ygU1TqIAAAAAAADADgAQDgoAAiIpqrsLjAyNDY4OjwCAAAAAAAFgD4AAA4PoCIiOYqLC4wMjQ2ODo8AgAAAAAAAAAAgICAAAAAAABAAAAAgIBPZ2dTAAQBAAAAAAAAAMViAAACAAAA22A/JwIBAQAK",o=atob(n),r=new ArrayBuffer(o.length),s=new Uint8Array(r),a=0;a<o.length;a++)s[a]=o.charCodeAt(a);t.SoundManager=i}(window,document);
"use strict";String.prototype.score=function(t,r){if(this===t)return 1;if(""===t)return 0;var e,i,s=0,n=this.toLowerCase(),o=this.length,f=t.toLowerCase(),h=t.length;e=0;var u,a,c=1;if(r&&(u=1-r),r)for(a=0;a<h;a+=1)i=n.indexOf(f[a],e),-1===i?c+=u:(e===i?e=.7:(e=.1," "===this[i-1]&&(e+=.8)),this[i]===t[a]&&(e+=.1),s+=e,e=i+1);else for(a=0;a<h;a+=1){if(i=n.indexOf(f[a],e),-1===i)return 0;e===i?e=.7:(e=.1," "===this[i-1]&&(e+=.8)),this[i]===t[a]&&(e+=.1),s+=e,e=i+1}return s=.5*(s/o+s/h)/c,f[0]===n[0]&&.85>s&&(s+=.15),s};
//# sourceMappingURL=hues-min.js.map
